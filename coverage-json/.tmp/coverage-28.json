{"c:/Users/mtama/node/vector-db/src/schemas/vector.schema.ts":{"path":"c:/Users/mtama/node/vector-db/src/schemas/vector.schema.ts","statementMap":{"0":{"start":{"line":2,"column":36},"end":{"line":7,"column":16}},"1":{"start":{"line":8,"column":28},"end":{"line":28,"column":2}},"2":{"start":{"line":29,"column":34},"end":{"line":45,"column":2}},"3":{"start":{"line":46,"column":36},"end":{"line":50,"column":2}},"4":{"start":{"line":51,"column":40},"end":{"line":56,"column":2}},"5":{"start":{"line":57,"column":42},"end":{"line":61,"column":2}},"6":{"start":{"line":62,"column":50},"end":{"line":70,"column":2}}},"fnMap":{},"branchMap":{},"s":{"0":1,"1":1,"2":1,"3":1,"4":1,"5":1,"6":1},"f":{},"b":{},"inputSourceMap":{"version":3,"sources":["C:/Users/mtama/node/vector-db/src/schemas/vector.schema.ts"],"sourcesContent":["import { z } from '@hono/zod-openapi'\n\nexport const VectorMetadataSchema = z.object({\n  title: z.string().optional(),\n  content: z.string().optional(),\n  url: z.string().url().optional(),\n  timestamp: z.string().datetime().optional(),\n}).passthrough()\n\nexport const VectorSchema = z.object({\n  id: z.string().min(1).openapi({\n    example: 'vec_123456',\n    description: 'ベクトルの一意識別子'\n  }),\n  values: z.union([\n    z.array(z.number()),\n    z.any() // VectorFloatArray (Float32Array)\n  ]).openapi({\n    example: [0.1, 0.2, 0.3],\n    description: 'ベクトルの数値配列またはFloat32Array'\n  }),\n  namespace: z.string().optional().openapi({\n    example: 'default',\n    description: 'ベクトルの名前空間'\n  }),\n  metadata: VectorMetadataSchema.optional().openapi({\n    description: 'ベクトルに関連付けられたメタデータ'\n  })\n})\n\nexport const CreateVectorSchema = z.object({\n  text: z.string().min(1).openapi({\n    example: 'これはサンプルテキストです',\n    description: 'ベクトル化するテキスト'\n  }),\n  model: z.string().optional().openapi({\n    example: '@cf/baai/bge-base-en-v1.5',\n    description: '使用するモデル名'\n  }),\n  namespace: z.string().optional().openapi({\n    example: 'default',\n    description: 'ベクトルの名前空間'\n  }),\n  metadata: VectorMetadataSchema.optional().openapi({\n    description: 'ベクトルに関連付けるメタデータ'\n  })\n})\n\nexport const VectorResponseSchema = z.object({\n  success: z.boolean(),\n  data: VectorSchema,\n  message: z.string().optional()\n})\n\nexport const VectorListResponseSchema = z.object({\n  success: z.boolean(),\n  data: z.array(VectorSchema),\n  count: z.number(),\n  message: z.string().optional()\n})\n\nexport const DeleteVectorResponseSchema = z.object({\n  success: z.boolean(),\n  deletedCount: z.number(),\n  message: z.string().optional()\n})\n\n// 非同期操作レスポンススキーマ\nexport const AsyncVectorOperationResponseSchema = z.object({\n  success: z.boolean(),\n  data: z.object({\n    jobId: z.string(),\n    workflowId: z.string(),\n    status: z.string(),\n    message: z.string()\n  })\n})\n\nexport type Vector = z.infer<typeof VectorSchema>\nexport type CreateVector = z.infer<typeof CreateVectorSchema>\nexport type VectorResponse = z.infer<typeof VectorResponseSchema>\nexport type VectorListResponse = z.infer<typeof VectorListResponseSchema>\nexport type DeleteVectorResponse = z.infer<typeof DeleteVectorResponseSchema>\nexport type VectorMetadata = z.infer<typeof VectorMetadataSchema>\nexport type AsyncVectorOperationResponse = z.infer<typeof AsyncVectorOperationResponseSchema>"],"mappings":"AAAA,SAAS,SAAS;AAEX,aAAM,uBAAuB,EAAE,OAAO;AAAA,EAC3C,OAAO,EAAE,OAAO,EAAE,SAAS;AAAA,EAC3B,SAAS,EAAE,OAAO,EAAE,SAAS;AAAA,EAC7B,KAAK,EAAE,OAAO,EAAE,IAAI,EAAE,SAAS;AAAA,EAC/B,WAAW,EAAE,OAAO,EAAE,SAAS,EAAE,SAAS;AAC5C,CAAC,EAAE,YAAY;AAER,aAAM,eAAe,EAAE,OAAO;AAAA,EACnC,IAAI,EAAE,OAAO,EAAE,IAAI,CAAC,EAAE,QAAQ;AAAA,IAC5B,SAAS;AAAA,IACT,aAAa;AAAA,EACf,CAAC;AAAA,EACD,QAAQ,EAAE,MAAM;AAAA,IACd,EAAE,MAAM,EAAE,OAAO,CAAC;AAAA,IAClB,EAAE,IAAI;AAAA;AAAA,EACR,CAAC,EAAE,QAAQ;AAAA,IACT,SAAS,CAAC,KAAK,KAAK,GAAG;AAAA,IACvB,aAAa;AAAA,EACf,CAAC;AAAA,EACD,WAAW,EAAE,OAAO,EAAE,SAAS,EAAE,QAAQ;AAAA,IACvC,SAAS;AAAA,IACT,aAAa;AAAA,EACf,CAAC;AAAA,EACD,UAAU,qBAAqB,SAAS,EAAE,QAAQ;AAAA,IAChD,aAAa;AAAA,EACf,CAAC;AACH,CAAC;AAEM,aAAM,qBAAqB,EAAE,OAAO;AAAA,EACzC,MAAM,EAAE,OAAO,EAAE,IAAI,CAAC,EAAE,QAAQ;AAAA,IAC9B,SAAS;AAAA,IACT,aAAa;AAAA,EACf,CAAC;AAAA,EACD,OAAO,EAAE,OAAO,EAAE,SAAS,EAAE,QAAQ;AAAA,IACnC,SAAS;AAAA,IACT,aAAa;AAAA,EACf,CAAC;AAAA,EACD,WAAW,EAAE,OAAO,EAAE,SAAS,EAAE,QAAQ;AAAA,IACvC,SAAS;AAAA,IACT,aAAa;AAAA,EACf,CAAC;AAAA,EACD,UAAU,qBAAqB,SAAS,EAAE,QAAQ;AAAA,IAChD,aAAa;AAAA,EACf,CAAC;AACH,CAAC;AAEM,aAAM,uBAAuB,EAAE,OAAO;AAAA,EAC3C,SAAS,EAAE,QAAQ;AAAA,EACnB,MAAM;AAAA,EACN,SAAS,EAAE,OAAO,EAAE,SAAS;AAC/B,CAAC;AAEM,aAAM,2BAA2B,EAAE,OAAO;AAAA,EAC/C,SAAS,EAAE,QAAQ;AAAA,EACnB,MAAM,EAAE,MAAM,YAAY;AAAA,EAC1B,OAAO,EAAE,OAAO;AAAA,EAChB,SAAS,EAAE,OAAO,EAAE,SAAS;AAC/B,CAAC;AAEM,aAAM,6BAA6B,EAAE,OAAO;AAAA,EACjD,SAAS,EAAE,QAAQ;AAAA,EACnB,cAAc,EAAE,OAAO;AAAA,EACvB,SAAS,EAAE,OAAO,EAAE,SAAS;AAC/B,CAAC;AAGM,aAAM,qCAAqC,EAAE,OAAO;AAAA,EACzD,SAAS,EAAE,QAAQ;AAAA,EACnB,MAAM,EAAE,OAAO;AAAA,IACb,OAAO,EAAE,OAAO;AAAA,IAChB,YAAY,EAAE,OAAO;AAAA,IACrB,QAAQ,EAAE,OAAO;AAAA,IACjB,SAAS,EAAE,OAAO;AAAA,EACpB,CAAC;AACH,CAAC;","names":[]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"2e3dc4b53178f16a9638cf10f62a78c104331f66"},"c:/Users/mtama/node/vector-db/src/schemas/error.schema.ts":{"path":"c:/Users/mtama/node/vector-db/src/schemas/error.schema.ts","statementMap":{"0":{"start":{"line":2,"column":35},"end":{"line":15,"column":2}}},"fnMap":{},"branchMap":{},"s":{"0":1},"f":{},"b":{},"inputSourceMap":{"version":3,"sources":["C:/Users/mtama/node/vector-db/src/schemas/error.schema.ts"],"sourcesContent":["import { z } from '@hono/zod-openapi'\n\nexport const ErrorResponseSchema = z.object({\n  success: z.literal(false),\n  error: z.string().openapi({\n    example: 'Bad Request',\n    description: 'エラーの種類'\n  }),\n  message: z.string().openapi({\n    example: '無効なリクエストパラメータです',\n    description: 'エラーの詳細メッセージ'\n  }),\n  details: z.any().optional().openapi({\n    description: 'エラーの詳細情報'\n  })\n})\n\nexport type ErrorResponse = z.infer<typeof ErrorResponseSchema>"],"mappings":"AAAA,SAAS,SAAS;AAEX,aAAM,sBAAsB,EAAE,OAAO;AAAA,EAC1C,SAAS,EAAE,QAAQ,KAAK;AAAA,EACxB,OAAO,EAAE,OAAO,EAAE,QAAQ;AAAA,IACxB,SAAS;AAAA,IACT,aAAa;AAAA,EACf,CAAC;AAAA,EACD,SAAS,EAAE,OAAO,EAAE,QAAQ;AAAA,IAC1B,SAAS;AAAA,IACT,aAAa;AAAA,EACf,CAAC;AAAA,EACD,SAAS,EAAE,IAAI,EAAE,SAAS,EAAE,QAAQ;AAAA,IAClC,aAAa;AAAA,EACf,CAAC;AACH,CAAC;","names":[]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"d6a63d60aa5985710aa1a5dd58befc74fd0f881d"},"c:/Users/mtama/node/vector-db/src/routes/api/vectors/create.ts":{"path":"c:/Users/mtama/node/vector-db/src/routes/api/vectors/create.ts","statementMap":{"0":{"start":{"line":7,"column":33},"end":{"line":48,"column":2}},"1":{"start":{"line":49,"column":35},"end":{"line":77,"column":1}},"2":{"start":{"line":50,"column":2},"end":{"line":76,"column":3}},"3":{"start":{"line":51,"column":17},"end":{"line":51,"column":36}},"4":{"start":{"line":52,"column":28},"end":{"line":52,"column":68}},"5":{"start":{"line":53,"column":26},"end":{"line":53,"column":65}},"6":{"start":{"line":54,"column":19},"end":{"line":59,"column":5}},"7":{"start":{"line":60,"column":4},"end":{"line":68,"column":12}},"8":{"start":{"line":70,"column":4},"end":{"line":70,"column":49}},"9":{"start":{"line":71,"column":4},"end":{"line":75,"column":12}}},"fnMap":{"0":{"name":"(anonymous_0)","decl":{"start":{"line":49,"column":35},"end":{"line":49,"column":36}},"loc":{"start":{"line":49,"column":48},"end":{"line":77,"column":1}},"line":49}},"branchMap":{"0":{"loc":{"start":{"line":74,"column":15},"end":{"line":74,"column":76}},"type":"cond-expr","locations":[{"start":{"line":74,"column":40},"end":{"line":74,"column":53}},{"start":{"line":74,"column":56},"end":{"line":74,"column":76}}],"line":74}},"s":{"0":1,"1":1,"2":4,"3":4,"4":4,"5":4,"6":4,"7":2,"8":2,"9":2},"f":{"0":4},"b":{"0":[1,1]},"inputSourceMap":{"version":3,"sources":["C:/Users/mtama/node/vector-db/src/routes/api/vectors/create.ts"],"sourcesContent":["import { createRoute, RouteHandler } from '@hono/zod-openapi'\nimport {\n  CreateVectorSchema,\n  AsyncVectorOperationResponseSchema,\n  type AsyncVectorOperationResponse\n} from '../../../schemas/vector.schema'\nimport { ErrorResponseSchema, type ErrorResponse } from '../../../schemas/error.schema'\n\n// 環境の型定義\ntype EnvType = {\n  Bindings: Env\n}\n\n// ベクトル作成ルート定義\nexport const createVectorRoute = createRoute({\n  method: 'post',\n  path: '/vectors',\n  request: {\n    body: {\n      content: {\n        'application/json': {\n          schema: CreateVectorSchema\n        }\n      }\n    }\n  },\n  responses: {\n    202: {\n      content: {\n        'application/json': {\n          schema: AsyncVectorOperationResponseSchema\n        }\n      },\n      description: 'ベクトル作成処理が開始されました'\n    },\n    400: {\n      content: {\n        'application/json': {\n          schema: ErrorResponseSchema\n        }\n      },\n      description: '不正なリクエスト'\n    },\n    500: {\n      content: {\n        'application/json': {\n          schema: ErrorResponseSchema\n        }\n      },\n      description: 'サーバーエラー'\n    }\n  },\n  tags: ['Vectors'],\n  summary: 'ベクトル作成',\n  description: 'テキストから埋め込みベクトルを生成して保存します'\n})\n\n// ベクトル作成ハンドラー\nexport const createVectorHandler: RouteHandler<typeof createVectorRoute, EnvType> = async (c) => {\n  try {\n    const body = c.req.valid('json')\n    \n    // VectorManager Durable Objectを使用\n    const vectorManagerId = c.env.VECTOR_CACHE.idFromName('default')\n    const vectorManager = c.env.VECTOR_CACHE.get(vectorManagerId)\n    \n    // 非同期でベクトルを作成\n    const result = await vectorManager.createVectorAsync(\n      body.text,\n      body.model,\n      body.namespace,\n      body.metadata\n    )\n    \n    return c.json<AsyncVectorOperationResponse, 202>({\n      success: true,\n      data: {\n        jobId: result.jobId,\n        workflowId: result.workflowId,\n        status: result.status,\n        message: 'ベクトルの作成を開始しました'\n      }\n    }, 202) // 202 Accepted for async operations\n  } catch (error) {\n    console.error('Create vector error:', error)\n    return c.json<ErrorResponse, 500>({\n      success: false,\n      error: 'Internal Server Error',\n      message: error instanceof Error ? error.message : 'ベクトル作成中にエラーが発生しました'\n    }, 500)\n  }\n}"],"mappings":"AAAA,SAAS,mBAAiC;AAC1C;AAAA,EACE;AAAA,EACA;AAAA,OAEK;AACP,SAAS,2BAA+C;AAQjD,aAAM,oBAAoB,YAAY;AAAA,EAC3C,QAAQ;AAAA,EACR,MAAM;AAAA,EACN,SAAS;AAAA,IACP,MAAM;AAAA,MACJ,SAAS;AAAA,QACP,oBAAoB;AAAA,UAClB,QAAQ;AAAA,QACV;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAAA,EACA,WAAW;AAAA,IACT,KAAK;AAAA,MACH,SAAS;AAAA,QACP,oBAAoB;AAAA,UAClB,QAAQ;AAAA,QACV;AAAA,MACF;AAAA,MACA,aAAa;AAAA,IACf;AAAA,IACA,KAAK;AAAA,MACH,SAAS;AAAA,QACP,oBAAoB;AAAA,UAClB,QAAQ;AAAA,QACV;AAAA,MACF;AAAA,MACA,aAAa;AAAA,IACf;AAAA,IACA,KAAK;AAAA,MACH,SAAS;AAAA,QACP,oBAAoB;AAAA,UAClB,QAAQ;AAAA,QACV;AAAA,MACF;AAAA,MACA,aAAa;AAAA,IACf;AAAA,EACF;AAAA,EACA,MAAM,CAAC,SAAS;AAAA,EAChB,SAAS;AAAA,EACT,aAAa;AACf,CAAC;AAGM,aAAM,sBAAuE,OAAO,MAAM;AAC/F,MAAI;AACF,UAAM,OAAO,EAAE,IAAI,MAAM,MAAM;AAG/B,UAAM,kBAAkB,EAAE,IAAI,aAAa,WAAW,SAAS;AAC/D,UAAM,gBAAgB,EAAE,IAAI,aAAa,IAAI,eAAe;AAG5D,UAAM,SAAS,MAAM,cAAc;AAAA,MACjC,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK;AAAA,MACL,KAAK;AAAA,IACP;AAEA,WAAO,EAAE,KAAwC;AAAA,MAC/C,SAAS;AAAA,MACT,MAAM;AAAA,QACJ,OAAO,OAAO;AAAA,QACd,YAAY,OAAO;AAAA,QACnB,QAAQ,OAAO;AAAA,QACf,SAAS;AAAA,MACX;AAAA,IACF,GAAG,GAAG;AAAA,EACR,SAAS,OAAO;AACd,YAAQ,MAAM,wBAAwB,KAAK;AAC3C,WAAO,EAAE,KAAyB;AAAA,MAChC,SAAS;AAAA,MACT,OAAO;AAAA,MACP,SAAS,iBAAiB,QAAQ,MAAM,UAAU;AAAA,IACpD,GAAG,GAAG;AAAA,EACR;AACF;","names":[]},"_coverageSchema":"1a1c01bbd47fc00a2c39e90264f33305004495a9","hash":"9a71c99a76040b5e3e8c13322604402b0e0f9fba"}}