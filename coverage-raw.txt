$ vitest run --coverage --run

[1m[7m[36m RUN [39m[27m[22m [36mv2.1.9 [39m[90mC:/node/vector-db[39m
      [2mCoverage enabled with [22m[33mistanbul[39m

[vpw:info] Starting single runtime for vitest.config.ts...
[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould use custom namespace and metadata for PDF
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":"DESCRIPTION: Test PDF\nEXTRACTED_TEXT: Content"}
[FileProcessingWorkflow] Extracted text length: 45
[FileProcessingWorkflow] Step 3: Vectorizing 2 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/2: embed_pdf_test.pdf_0_mezoglxw
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/2: pdf_test.pdf_0_mezoglxw
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/2: embed_pdf_test.pdf_1_mezoglxy
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/2: pdf_test.pdf_1_mezoglxy
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Vectorization complete. Saved 2 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 2

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould process PDF file successfully
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould process image file successfully
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: image
[FileProcessingWorkflow.processFile] File buffer size: 13
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 2

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI analysis failure
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 1

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle processing error
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11

[90mstderr[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle processing error
[22m[39m[FileProcessingWorkflow] File processing failed: Error: Processing failed
    at /C:/node/vector-db/tests/unit/workflows/file-processing.test.ts:206:51
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)
[FileProcessingWorkflow] Error details: Error: Processing failed
    at /C:/node/vector-db/tests/unit/workflows/file-processing.test.ts:206:51
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle long text chunking
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 5

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle file without description
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":"DESCRIPTION: \nEXTRACTED_TEXT: Some text\nTOPICS: topics\nKEYWORDS: keywords"}
[FileProcessingWorkflow] Extracted text length: 73
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] Step 3: Vectorizing 3 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/3: embed_pdf_test.pdf_0_mezogly6
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/3: pdf_test.pdf_0_mezogly6
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/3: embed_pdf_test.pdf_1_mezogly7
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/3: pdf_test.pdf_1_mezogly7
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Creating embedding workflow 3/3: embed_pdf_test.pdf_2_mezogly7
[FileProcessingWorkflow] Polling embedding workflow for chunk 3
[FileProcessingWorkflow] Embedding completed for chunk 3
[FileProcessingWorkflow] Embedding generated for chunk 3, vector dims: 3
[FileProcessingWorkflow] Saving vector 3/3: pdf_test.pdf_2_mezogly7
[FileProcessingWorkflow] Vector saved for chunk 3
[FileProcessingWorkflow] Successfully saved vector for chunk 3
[FileProcessingWorkflow] Vectorization complete. Saved 3 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle file without topics and keywords
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":"DESCRIPTION: Test PDF\nEXTRACTED_TEXT: Content"}
[FileProcessingWorkflow] Extracted text length: 45
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] Step 3: Vectorizing 3 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/3: embed_pdf_test.pdf_0_mezogly8
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/3: pdf_test.pdf_0_mezogly8
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/3: embed_pdf_test.pdf_1_mezogly8
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/3: pdf_test.pdf_1_mezogly8
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Creating embedding workflow 3/3: embed_pdf_test.pdf_2_mezogly8
[FileProcessingWorkflow] Polling embedding workflow for chunk 3
[FileProcessingWorkflow] Embedding completed for chunk 3
[FileProcessingWorkflow] Embedding generated for chunk 3, vector dims: 3
[FileProcessingWorkflow] Saving vector 3/3: pdf_test.pdf_2_mezogly8
[FileProcessingWorkflow] Vector saved for chunk 3
[FileProcessingWorkflow] Successfully saved vector for chunk 3
[FileProcessingWorkflow] Vectorization complete. Saved 3 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle file without extracted text
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: image
[FileProcessingWorkflow.processFile] File buffer size: 13
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 13
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":"DESCRIPTION: Test image\nEXTRACTED_TEXT: \nTOPICS: image topics\nKEYWORDS: image, test"}
[FileProcessingWorkflow] Extracted text length: 83
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] Step 3: Vectorizing 3 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/3: embed_ima_test.jpg_0_mezogly9
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/3: ima_test.jpg_0_mezogly9
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/3: embed_ima_test.jpg_1_mezoglya
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/3: ima_test.jpg_1_mezoglya
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Creating embedding workflow 3/3: embed_ima_test.jpg_2_mezoglya
[FileProcessingWorkflow] Polling embedding workflow for chunk 3
[FileProcessingWorkflow] Embedding completed for chunk 3
[FileProcessingWorkflow] Embedding generated for chunk 3, vector dims: 3
[FileProcessingWorkflow] Saving vector 3/3: ima_test.jpg_2_mezoglya
[FileProcessingWorkflow] Vector saved for chunk 3
[FileProcessingWorkflow] Successfully saved vector for chunk 3
[FileProcessingWorkflow] Vectorization complete. Saved 3 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle non-Error thrown in AI analysis
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstderr[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle non-Error thrown in AI analysis
[22m[39m[FileProcessingWorkflow] AI analysis failed: String error not an Error object
[FileProcessingWorkflow] Error stack: No stack

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI run failure inside step
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] Step 3: Vectorizing 3 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/3: embed_pdf_test.pdf_0_mezoglyc
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/3: pdf_test.pdf_0_mezoglyc
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/3: embed_pdf_test.pdf_1_mezoglyc
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/3: pdf_test.pdf_1_mezoglyc
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Creating embedding workflow 3/3: embed_pdf_test.pdf_2_mezoglyc
[FileProcessingWorkflow] Polling embedding workflow for chunk 3
[FileProcessingWorkflow] Embedding completed for chunk 3
[FileProcessingWorkflow] Embedding generated for chunk 3, vector dims: 3
[FileProcessingWorkflow] Saving vector 3/3: pdf_test.pdf_2_mezoglyc
[FileProcessingWorkflow] Vector saved for chunk 3
[FileProcessingWorkflow] Successfully saved vector for chunk 3
[FileProcessingWorkflow] Vectorization complete. Saved 3 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstderr[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI run failure inside step
[22m[39m[FileProcessingWorkflow] AI analysis failed: Error: AI service error
    at /C:/node/vector-db/tests/unit/workflows/file-processing.test.ts:426:50
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)
[FileProcessingWorkflow] Error stack: Error: AI service error
    at /C:/node/vector-db/tests/unit/workflows/file-processing.test.ts:426:50
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle text exactly at chunk boundary
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":"DESCRIPTION: Boundary test\nEXTRACTED_TEXT: BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
[FileProcessingWorkflow] Extracted text length: 2075
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 5 content chunks
[FileProcessingWorkflow] Step 3: Vectorizing 5 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/5: embed_pdf_boundary.p_0_mezoglyd
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/5: pdf_boundary.p_0_mezoglyd
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/5: embed_pdf_boundary.p_1_mezoglyd
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/5: pdf_boundary.p_1_mezoglyd
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Creating embedding workflow 3/5: embed_pdf_boundary.p_2_mezoglyd
[FileProcessingWorkflow] Polling embedding workflow for chunk 3
[FileProcessingWorkflow] Embedding completed for chunk 3
[FileProcessingWorkflow] Embedding generated for chunk 3, vector dims: 3
[FileProcessingWorkflow] Saving vector 3/5: pdf_boundary.p_2_mezoglyd
[FileProcessingWorkflow] Vector saved for chunk 3
[FileProcessingWorkflow] Successfully saved vector for chunk 3
[FileProcessingWorkflow] Creating embedding workflow 4/5: embed_pdf_boundary.p_3_mezoglyd
[FileProcessingWorkflow] Polling embedding workflow for chunk 4
[FileProcessingWorkflow] Embedding completed for chunk 4
[FileProcessingWorkflow] Embedding generated for chunk 4, vector dims: 3
[FileProcessingWorkflow] Saving vector 4/5: pdf_boundary.p_3_mezoglyd
[FileProcessingWorkflow] Vector saved for chunk 4
[FileProcessingWorkflow] Successfully saved vector for chunk 4
[FileProcessingWorkflow] Creating embedding workflow 5/5: embed_pdf_boundary.p_4_mezoglyd
[FileProcessingWorkflow] Polling embedding workflow for chunk 5
[FileProcessingWorkflow] Embedding completed for chunk 5
[FileProcessingWorkflow] Embedding generated for chunk 5, vector dims: 3
[FileProcessingWorkflow] Saving vector 5/5: pdf_boundary.p_4_mezoglyd
[FileProcessingWorkflow] Vector saved for chunk 5
[FileProcessingWorkflow] Successfully saved vector for chunk 5
[FileProcessingWorkflow] Vectorization complete. Saved 5 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 5

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould use fallback description when AI returns no description
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":"EXTRACTED_TEXT: Some content\nTOPICS: test"}
[FileProcessingWorkflow] Extracted text length: 41
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] Step 3: Vectorizing 3 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/3: embed_pdf_test.pdf_0_mezoglye
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/3: pdf_test.pdf_0_mezoglye
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/3: embed_pdf_test.pdf_1_mezoglye
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/3: pdf_test.pdf_1_mezoglye
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Creating embedding workflow 3/3: embed_pdf_test.pdf_2_mezoglye
[FileProcessingWorkflow] Polling embedding workflow for chunk 3
[FileProcessingWorkflow] Embedding completed for chunk 3
[FileProcessingWorkflow] Embedding generated for chunk 3, vector dims: 3
[FileProcessingWorkflow] Saving vector 3/3: pdf_test.pdf_2_mezoglye
[FileProcessingWorkflow] Vector saved for chunk 3
[FileProcessingWorkflow] Successfully saved vector for chunk 3
[FileProcessingWorkflow] Vectorization complete. Saved 3 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle non-Error exception in catch block
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11

[90mstderr[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle non-Error exception in catch block
[22m[39m[FileProcessingWorkflow] File processing failed: String error
[FileProcessingWorkflow] Error details: No stack

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle image error with proper type
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: image
[FileProcessingWorkflow.processFile] File buffer size: 13

[90mstderr[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle image error with proper type
[22m[39m[FileProcessingWorkflow] File processing failed: Error: Image processing error
    at /C:/node/vector-db/tests/unit/workflows/file-processing.test.ts:524:51
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)
[FileProcessingWorkflow] Error details: Error: Image processing error
    at /C:/node/vector-db/tests/unit/workflows/file-processing.test.ts:524:51
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI response with text field
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI response with description field
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: image
[FileProcessingWorkflow.processFile] File buffer size: 13
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI response with generated_text field
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI response with result field
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI response as direct string
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI response that returns boolean true
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] AI result type: boolean
[FileProcessingWorkflow] AI result: true
[FileProcessingWorkflow] Extracted text length: 0
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 0

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI response with null result
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI response with empty object
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI response that returns object without string properties
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":123,"text":false,"description":null,"result":{}}
[FileProcessingWorkflow] Extracted text length: 0
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 2

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle AI response with non-string fields
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle undefined response from extractTextFromResult
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 0

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle file analysis without description
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":"EXTRACTED_TEXT: Just text content\nTOPICS: pdf\nKEYWORDS: test"}
[FileProcessingWorkflow] Extracted text length: 60
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 2

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle file analysis without topics and keywords
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 2

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle error in extractTextFromResult
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstderr[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle error in extractTextFromResult
[22m[39m[FileProcessingWorkflow] AI analysis failed: Error: Property access error
    at Object.get (/C:/node/vector-db/tests/unit/workflows/file-processing.test.ts:1014:17)
    at Promise.resolve (<anonymous>)
    at Object.<anonymous> (C:/node/vector-db/node_modules/@vitest/spy/dist/index.js:124:83)
    at Object.mockCall (C:/node/vector-db/node_modules/@vitest/spy/dist/index.js:61:17)
    at Object.spy (C:/node/vector-db/node_modules/tinyspy/dist/index.js:45:80)
    at /C:/node/vector-db/src/workflows/file-processing.ts:3635:71
    at Object.<anonymous> (/C:/node/vector-db/tests/unit/workflows/file-processing.test.ts:1020:24)
    at Object.mockCall (C:/node/vector-db/node_modules/@vitest/spy/dist/index.js:61:17)
    at Object.spy [as do] (C:/node/vector-db/node_modules/tinyspy/dist/index.js:45:80)
    at FileProcessingWorkflow.processFile (/C:/node/vector-db/src/workflows/file-processing.ts:3600:68)
[FileProcessingWorkflow] Error stack: Error: Property access error
    at Object.get (/C:/node/vector-db/tests/unit/workflows/file-processing.test.ts:1014:17)
    at Promise.resolve (<anonymous>)
    at Object.<anonymous> (C:/node/vector-db/node_modules/@vitest/spy/dist/index.js:124:83)
    at Object.mockCall (C:/node/vector-db/node_modules/@vitest/spy/dist/index.js:61:17)
    at Object.spy (C:/node/vector-db/node_modules/tinyspy/dist/index.js:45:80)
    at /C:/node/vector-db/src/workflows/file-processing.ts:3635:71
    at Object.<anonymous> (/C:/node/vector-db/tests/unit/workflows/file-processing.test.ts:1020:24)
    at Object.mockCall (C:/node/vector-db/node_modules/@vitest/spy/dist/index.js:61:17)
    at Object.spy [as do] (C:/node/vector-db/node_modules/tinyspy/dist/index.js:45:80)
    at FileProcessingWorkflow.processFile (/C:/node/vector-db/src/workflows/file-processing.ts:3600:68)

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle empty string response from AI
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 2

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mprocessFile[2m > [22m[2mshould handle embedding generation failure and skip chunk
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":"DESCRIPTION: Test PDF\nEXTRACTED_TEXT: Content\nTOPICS: test\nKEYWORDS: pdf"}
[FileProcessingWorkflow] Extracted text length: 72
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] Step 3: Vectorizing 3 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/3: embed_pdf_test.pdf_0_mezoglyr
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/3: pdf_test.pdf_0_mezoglyr
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/3: embed_pdf_test.pdf_1_mezoglyr
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/3: pdf_test.pdf_1_mezoglyr
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Creating embedding workflow 3/3: embed_pdf_test.pdf_2_mezoglyr
[FileProcessingWorkflow] Polling embedding workflow for chunk 3
[FileProcessingWorkflow] Embedding completed for chunk 3
[FileProcessingWorkflow] Embedding generated for chunk 3, vector dims: 3
[FileProcessingWorkflow] Saving vector 3/3: pdf_test.pdf_2_mezoglyr
[FileProcessingWorkflow] Vector saved for chunk 3
[FileProcessingWorkflow] Successfully saved vector for chunk 3
[FileProcessingWorkflow] Vectorization complete. Saved 3 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mrun[2m > [22m[2mshould handle unsupported file type
[22m[39m[FileProcessingWorkflow] Starting file processing workflow
[FileProcessingWorkflow] File info: {
  fileName: 'test.txt',
  fileType: 'text/plain',
  fileSize: 100,
  namespace: undefined
}

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mrun[2m > [22m[2mshould process PDF file through run method
[22m[39m[FileProcessingWorkflow] Starting file processing workflow
[FileProcessingWorkflow] File info: {
  fileName: 'test.pdf',
  fileType: 'application/pdf',
  fileSize: 1024,
  namespace: undefined
}
[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 11
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":"DESCRIPTION: Test PDF\nEXTRACTED_TEXT: Content"}
[FileProcessingWorkflow] Extracted text length: 45
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] Step 3: Vectorizing 3 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/3: embed_pdf_test.pdf_0_mezoglyu
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/3: pdf_test.pdf_0_mezoglyu
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/3: embed_pdf_test.pdf_1_mezoglyu
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/3: pdf_test.pdf_1_mezoglyu
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Creating embedding workflow 3/3: embed_pdf_test.pdf_2_mezoglyv
[FileProcessingWorkflow] Polling embedding workflow for chunk 3
[FileProcessingWorkflow] Embedding completed for chunk 3
[FileProcessingWorkflow] Embedding generated for chunk 3, vector dims: 3
[FileProcessingWorkflow] Saving vector 3/3: pdf_test.pdf_2_mezoglyv
[FileProcessingWorkflow] Vector saved for chunk 3
[FileProcessingWorkflow] Successfully saved vector for chunk 3
[FileProcessingWorkflow] Vectorization complete. Saved 3 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mrun[2m > [22m[2mshould process image file through run method
[22m[39m[FileProcessingWorkflow] Starting file processing workflow
[FileProcessingWorkflow] File info: {
  fileName: 'test.png',
  fileType: 'image/png',
  fileSize: 2048,
  namespace: undefined
}
[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: image
[FileProcessingWorkflow.processFile] File buffer size: 13
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] Using AI model for text extraction: @cf/meta/llama-3-8b-instruct
[FileProcessingWorkflow] Sending file data to Gemma, buffer length: 13
[FileProcessingWorkflow] AI result type: object
[FileProcessingWorkflow] AI result: {"response":"DESCRIPTION: Test image\nEXTRACTED_TEXT: "}
[FileProcessingWorkflow] Extracted text length: 40
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] Step 3: Vectorizing 3 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/3: embed_ima_test.png_0_mezoglyw
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/3: ima_test.png_0_mezoglyw
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/3: embed_ima_test.png_1_mezoglyw
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/3: ima_test.png_1_mezoglyw
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Creating embedding workflow 3/3: embed_ima_test.png_2_mezoglyw
[FileProcessingWorkflow] Polling embedding workflow for chunk 3
[FileProcessingWorkflow] Embedding completed for chunk 3
[FileProcessingWorkflow] Embedding generated for chunk 3, vector dims: 3
[FileProcessingWorkflow] Saving vector 3/3: ima_test.png_2_mezoglyw
[FileProcessingWorkflow] Vector saved for chunk 3
[FileProcessingWorkflow] Successfully saved vector for chunk 3
[FileProcessingWorkflow] Vectorization complete. Saved 3 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mLarge file and workflow errors[2m > [22m[2mshould handle large file (>2MB) with simple extraction
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 17
[FileProcessingWorkflow] Step 1: Analyzing file with AI
[FileProcessingWorkflow] File too large for AI analysis (>2MB), using simple extraction
[FileProcessingWorkflow] Step 2: Preparing content chunks
[FileProcessingWorkflow] Created 3 content chunks
[FileProcessingWorkflow] Step 3: Vectorizing 3 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/3: embed_pdf_large.pdf_0_mezoglyz
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/3: pdf_large.pdf_0_mezoglyz
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/3: embed_pdf_large.pdf_1_mezoglyz
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Embedding completed for chunk 2
[FileProcessingWorkflow] Embedding generated for chunk 2, vector dims: 3
[FileProcessingWorkflow] Saving vector 2/3: pdf_large.pdf_1_mezoglyz
[FileProcessingWorkflow] Vector saved for chunk 2
[FileProcessingWorkflow] Successfully saved vector for chunk 2
[FileProcessingWorkflow] Creating embedding workflow 3/3: embed_pdf_large.pdf_2_mezoglz0
[FileProcessingWorkflow] Polling embedding workflow for chunk 3
[FileProcessingWorkflow] Embedding completed for chunk 3
[FileProcessingWorkflow] Embedding generated for chunk 3, vector dims: 3
[FileProcessingWorkflow] Saving vector 3/3: pdf_large.pdf_2_mezoglz0
[FileProcessingWorkflow] Vector saved for chunk 3
[FileProcessingWorkflow] Successfully saved vector for chunk 3
[FileProcessingWorkflow] Vectorization complete. Saved 3 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 3

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mLarge file and workflow errors[2m > [22m[2mshould handle embedding workflow errored status
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 3: Vectorizing 2 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/2: embed_pdf_test.pdf_0_mezoglz1
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Creating embedding workflow 2/2: embed_pdf_test.pdf_1_mezoglz1
[FileProcessingWorkflow] Polling embedding workflow for chunk 2
[FileProcessingWorkflow] Vectorization complete. Saved 0 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 0

[90mstderr[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mLarge file and workflow errors[2m > [22m[2mshould handle embedding workflow errored status
[22m[39m[FileProcessingWorkflow] Embedding workflow failed for chunk 1: Embedding generation failed
[FileProcessingWorkflow] Failed to generate embedding for chunk 1: Timeout
[FileProcessingWorkflow] Embedding workflow failed for chunk 2: Embedding generation failed
[FileProcessingWorkflow] Failed to generate embedding for chunk 2: Timeout

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mLarge file and workflow errors[2m > [22m[2mshould handle vector save workflow errored status
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 3: Vectorizing 1 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/1: embed_pdf_test.pdf_0_mezoglz1
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/1: pdf_test.pdf_0_mezoglz1
[FileProcessingWorkflow] Vectorization complete. Saved 0 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 0

[90mstderr[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mLarge file and workflow errors[2m > [22m[2mshould handle vector save workflow errored status
[22m[39m[FileProcessingWorkflow] Vector save failed for chunk 1: Vector save failed
[FileProcessingWorkflow] Failed to save vector for chunk 1

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mLarge file and workflow errors[2m > [22m[2mshould handle vector save success false result
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 3: Vectorizing 1 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/1: embed_pdf_test.pdf_0_mezoglz2
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/1: pdf_test.pdf_0_mezoglz2
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Vectorization complete. Saved 0 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 0

[90mstderr[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mLarge file and workflow errors[2m > [22m[2mshould handle vector save success false result
[22m[39m[FileProcessingWorkflow] Failed to save vector for chunk 1

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mLarge file and workflow errors[2m > [22m[2mshould handle embedding workflow with pending status then complete
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 3: Vectorizing 1 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/1: embed_pdf_test.pdf_0_mezoglz3
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/1: pdf_test.pdf_0_mezoglz3
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Vectorization complete. Saved 1 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 1

[90mstdout[2m | tests/unit/workflows/file-processing.test.ts[2m > [22m[2mFileProcessingWorkflow[2m > [22m[2mLarge file and workflow errors[2m > [22m[2mshould handle vector save workflow with pending status then complete
[22m[39m[FileProcessingWorkflow.processFile] Starting file processing
[FileProcessingWorkflow.processFile] File type: pdf
[FileProcessingWorkflow.processFile] File buffer size: 11
[FileProcessingWorkflow] Step 3: Vectorizing 1 chunks
[FileProcessingWorkflow] Creating embedding workflow 1/1: embed_pdf_test.pdf_0_mezoglz4
[FileProcessingWorkflow] Polling embedding workflow for chunk 1
[FileProcessingWorkflow] Embedding completed for chunk 1
[FileProcessingWorkflow] Embedding generated for chunk 1, vector dims: 3
[FileProcessingWorkflow] Saving vector 1/1: pdf_test.pdf_0_mezoglz4
[FileProcessingWorkflow] Vector saved for chunk 1
[FileProcessingWorkflow] Successfully saved vector for chunk 1
[FileProcessingWorkflow] Vectorization complete. Saved 1 vectors
[FileProcessingWorkflow] File processing completed successfully
[FileProcessingWorkflow] Total vectors created: 1

 [32m✓[39m tests/unit/workflows/file-processing.test.ts [2m([22m[2m58 tests[22m[2m)[22m[90m 7[2mms[22m[39m
[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould create vector asynchronously using workflow
[22m[39mAttempt 1: Workflow status: {
  status: 'complete',
  output: {
    success: true,
    embedding: [ 0.1, 0.2, 0.3 ],
    model: '@cf/baai/bge-base-en-v1.5'
  }
}
Vector workflow attempt 1: complete
Vector saved successfully: vec-123

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould use default namespace when undefined and handle undefined recentVectors
[22m[39mAttempt 1: Workflow status: {
  status: 'complete',
  output: {
    success: true,
    embedding: [ 0.1, 0.2, 0.3 ],
    model: '@cf/baai/bge-base-en-v1.5'
  }
}
Vector workflow attempt 1: complete
Vector saved successfully: vec-123

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle embedding workflow failure
[22m[39mAttempt 1: Workflow status: { status: 'errored', error: 'Embedding failed' }

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle embedding workflow failure with undefined error
[22m[39mAttempt 1: Workflow status: { status: 'errored', error: undefined }

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle embedding timeout
[22m[39mAttempt 1: Workflow status: { status: 'running' }
Attempt 2: Workflow status: { status: 'running' }
Attempt 3: Workflow status: { status: 'running' }
Attempt 4: Workflow status: { status: 'running' }
Attempt 5: Workflow status: { status: 'running' }
Attempt 6: Workflow status: { status: 'running' }
Attempt 7: Workflow status: { status: 'running' }
Attempt 8: Workflow status: { status: 'running' }
Attempt 9: Workflow status: { status: 'running' }
Attempt 10: Workflow status: { status: 'running' }
Attempt 11: Workflow status: { status: 'running' }
Attempt 12: Workflow status: { status: 'running' }
Attempt 13: Workflow status: { status: 'running' }
Attempt 14: Workflow status: { status: 'running' }
Attempt 15: Workflow status: { status: 'running' }
Attempt 16: Workflow status: { status: 'running' }
Attempt 17: Workflow status: { status: 'running' }
Attempt 18: Workflow status: { status: 'running' }
Attempt 19: Workflow status: { status: 'running' }
Attempt 20: Workflow status: { status: 'running' }
Attempt 21: Workflow status: { status: 'running' }
Attempt 22: Workflow status: { status: 'running' }
Attempt 23: Workflow status: { status: 'running' }
Attempt 24: Workflow status: { status: 'running' }
Attempt 25: Workflow status: { status: 'running' }
Attempt 26: Workflow status: { status: 'running' }
Attempt 27: Workflow status: { status: 'running' }
Attempt 28: Workflow status: { status: 'running' }
Attempt 29: Workflow status: { status: 'running' }
Attempt 30: Workflow status: { status: 'running' }

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle vector workflow failure
[22m[39mAttempt 1: Workflow status: {
  status: 'complete',
  output: {
    success: true,
    embedding: [ 0.1, 0.2, 0.3 ],
    model: '@cf/baai/bge-base-en-v1.5'
  }
}
Vector workflow attempt 1: errored

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle vector workflow failure with undefined error
[22m[39mAttempt 1: Workflow status: {
  status: 'complete',
  output: {
    success: true,
    embedding: [ 0.1, 0.2, 0.3 ],
    model: '@cf/baai/bge-base-en-v1.5'
  }
}
Vector workflow attempt 1: errored

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle unsuccessful embedding result
[22m[39mAttempt 1: Workflow status: {
  status: 'complete',
  output: { success: false, error: 'Model error' }
}

[90mstderr[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle unsuccessful embedding result
[22m[39mFinal embedding result: {
  success: false,
  embedding: [],
  model: 'unknown',
  error: 'Model error',
  vectorId: ''
}

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle unsuccessful embedding with undefined error
[22m[39mAttempt 1: Workflow status: { status: 'complete', output: { success: false, error: undefined } }

[90mstderr[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle unsuccessful embedding with undefined error
[22m[39mFinal embedding result: {
  success: false,
  embedding: [],
  model: 'unknown',
  error: undefined,
  vectorId: ''
}

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle unsuccessful vector result
[22m[39mAttempt 1: Workflow status: {
  status: 'complete',
  output: {
    success: true,
    embedding: [ 0.1, 0.2, 0.3 ],
    model: '@cf/baai/bge-base-en-v1.5'
  }
}
Vector workflow attempt 1: complete

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle vector workflow timeout
[22m[39mAttempt 1: Workflow status: {
  status: 'complete',
  output: {
    success: true,
    embedding: [ 0.1, 0.2, 0.3 ],
    model: '@cf/baai/bge-base-en-v1.5'
  }
}
Vector workflow attempt 1: running
Vector workflow attempt 2: running
Vector workflow attempt 3: running
Vector workflow attempt 4: running
Vector workflow attempt 5: running
Vector workflow attempt 6: running
Vector workflow attempt 7: running
Vector workflow attempt 8: running
Vector workflow attempt 9: running
Vector workflow attempt 10: running
Vector workflow attempt 11: running
Vector workflow attempt 12: running
Vector workflow attempt 13: running
Vector workflow attempt 14: running
Vector workflow attempt 15: running
Vector workflow attempt 16: running
Vector workflow attempt 17: running
Vector workflow attempt 18: running
Vector workflow attempt 19: running
Vector workflow attempt 20: running
Vector workflow attempt 21: running
Vector workflow attempt 22: running
Vector workflow attempt 23: running
Vector workflow attempt 24: running
Vector workflow attempt 25: running
Vector workflow attempt 26: running
Vector workflow attempt 27: running
Vector workflow attempt 28: running
Vector workflow attempt 29: running
Vector workflow attempt 30: running

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mcreateVectorAsync[2m > [22m[2mshould handle null vector result
[22m[39mAttempt 1: Workflow status: {
  status: 'complete',
  output: {
    success: true,
    embedding: [ 0.1, 0.2, 0.3 ],
    model: '@cf/baai/bge-base-en-v1.5'
  }
}
Vector workflow attempt 1: complete
Vector workflow attempt 2: complete
Vector workflow attempt 3: complete
Vector workflow attempt 4: complete
Vector workflow attempt 5: complete
Vector workflow attempt 6: complete
Vector workflow attempt 7: complete
Vector workflow attempt 8: complete
Vector workflow attempt 9: complete
Vector workflow attempt 10: complete
Vector workflow attempt 11: complete
Vector workflow attempt 12: complete
Vector workflow attempt 13: complete
Vector workflow attempt 14: complete
Vector workflow attempt 15: complete
Vector workflow attempt 16: complete
Vector workflow attempt 17: complete
Vector workflow attempt 18: complete
Vector workflow attempt 19: complete
Vector workflow attempt 20: complete
Vector workflow attempt 21: complete
Vector workflow attempt 22: complete
Vector workflow attempt 23: complete
Vector workflow attempt 24: complete
Vector workflow attempt 25: complete
Vector workflow attempt 26: complete
Vector workflow attempt 27: complete
Vector workflow attempt 28: complete
Vector workflow attempt 29: complete
Vector workflow attempt 30: complete

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mDelete Operations[2m > [22m[2mshould remove deleted vectors from local state
[22m[39m[VectorManager] Removing 2 vectors from local state
[VectorManager] Updated local state, 1 vectors remaining

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mDelete Operations[2m > [22m[2mshould handle uninitialized recentVectors
[22m[39m[VectorManager] Removing 1 vectors from local state
[VectorManager] Initialized recentVectors array

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mDelete Operations[2m > [22m[2mshould delete all vectors
[22m[39m[VectorManager] Deleting all vectors in all namespaces
[VectorManager] Deleting 3 vectors from Vectorize
[VectorManager] Delete operation enqueued for 3 vectors
[VectorManager] Local state cleared

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mDelete Operations[2m > [22m[2mshould delete vectors by namespace
[22m[39m[VectorManager] Deleting all vectors in namespace: default
[VectorManager] Deleting 2 vectors from Vectorize
[VectorManager] Delete operation enqueued for 2 vectors
[VectorManager] Local state cleared

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mDelete Operations[2m > [22m[2mshould handle empty state when deleting all
[22m[39m[VectorManager] Deleting all vectors in all namespaces
[VectorManager] Local state cleared

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mDelete Operations[2m > [22m[2mshould handle uninitialized state when deleting all
[22m[39m[VectorManager] Deleting all vectors in all namespaces
[VectorManager] Local state cleared

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mDelete Operations[2m > [22m[2mshould continue on vectorize delete error
[22m[39m[VectorManager] Deleting all vectors in all namespaces
[VectorManager] Deleting 1 vectors from Vectorize
[VectorManager] Local state cleared

[90mstderr[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mDelete Operations[2m > [22m[2mshould continue on vectorize delete error
[22m[39m[VectorManager] Error deleting from Vectorize: Error: Delete failed
    at /C:/node/vector-db/tests/unit/durable-objects/vector-manager.test.ts:834:70
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstdout[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mDelete Operations[2m > [22m[2mshould throw error when state access fails
[22m[39m[VectorManager] Deleting all vectors in all namespaces

[90mstderr[2m | tests/unit/durable-objects/vector-manager.test.ts[2m > [22m[2mVectorManager Durable Object[2m > [22m[2mDelete Operations[2m > [22m[2mshould throw error when state access fails
[22m[39m[VectorManager] Delete all vectors error: Error: State access failed
    at VectorManager.get [as state] (/C:/node/vector-db/tests/unit/durable-objects/vector-manager.test.ts:849:17)
    at VectorManager.deleteAllVectors (/C:/node/vector-db/src/durable-objects/vector-manager.ts:5004:17)
    at /C:/node/vector-db/tests/unit/durable-objects/vector-manager.test.ts:853:56
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)

 [32m✓[39m tests/unit/durable-objects/vector-manager.test.ts [2m([22m[2m58 tests[22m[2m)[22m[90m 12[2mms[22m[39m
 [32m✓[39m tests/unit/utils/validation.test.ts [2m([22m[2m94 tests[22m[2m)[22m[90m 16[2mms[22m[39m
 [32m✓[39m tests/unit/workflows/notion-sync.test.ts [2m([22m[2m34 tests[22m[2m | [22m[33m11 skipped[39m[2m)[22m[90m 19[2mms[22m[39m
 [32m✓[39m tests/unit/utils/response-builder.test.ts [2m([22m[2m90 tests[22m[2m)[22m[90m 26[2mms[22m[39m
[90mstderr[2m | tests/unit/notion.service.test.ts[2m > [22m[2mNotionService[2m > [22m[2mfetchPageFromNotion[2m > [22m[2mshould throw error on API failure (non-404)
[22m[39mFailed to fetch page from Notion: Error: Notion API error: 500
    at NotionService.fetchPageFromNotion (/C:/node/vector-db/src/services/notion.service.ts:3823:15)

[90mstderr[2m | tests/unit/notion.service.test.ts[2m > [22m[2mNotionService[2m > [22m[2mfetchPagePropertyFromNotion[2m > [22m[2mshould throw error on property fetch failure
[22m[39mFailed to fetch property from Notion: Error: Notion API error: 500
    at NotionService.fetchPagePropertyFromNotion (/C:/node/vector-db/src/services/notion.service.ts:3900:15)

[90mstderr[2m | tests/unit/notion.service.test.ts[2m > [22m[2mNotionService[2m > [22m[2mfetchPagePropertyFromNotion[2m > [22m[2mshould handle fetch errors
[22m[39mFailed to fetch property from Notion: Error: Network error
    at /C:/node/vector-db/tests/unit/notion.service.test.ts:159:70
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/notion.service.test.ts[2m > [22m[2mNotionService[2m > [22m[2msearchAllPages[2m > [22m[2mshould throw error on search failure
[22m[39mFailed to search pages from Notion: Error: Notion API error: 400
    at NotionService.searchAllPages (/C:/node/vector-db/src/services/notion.service.ts:4110:15)

[90mstderr[2m | tests/unit/notion.service.test.ts[2m > [22m[2mNotionService[2m > [22m[2mError handling[2m > [22m[2mshould handle fetch errors in fetchBlocksFromNotion
[22m[39mFailed to fetch blocks from Notion: Error: Notion API error: 500
    at NotionService.fetchBlocksFromNotion (/C:/node/vector-db/src/services/notion.service.ts:3866:17)

[90mstderr[2m | tests/unit/notion.service.test.ts[2m > [22m[2mNotionService[2m > [22m[2mError handling[2m > [22m[2mshould handle network errors in fetchPageFromNotion
[22m[39mFailed to fetch page from Notion: Error: Network failed
    at /C:/node/vector-db/tests/unit/notion.service.test.ts:690:70
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

 [32m✓[39m tests/unit/notion.service.test.ts [2m([22m[2m37 tests[22m[2m)[22m[90m 4[2mms[22m[39m
[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould upload PDF file successfully
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=4a1082b5f5b6a3d01c7717828307ae10',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756643965804,
  constructor: 'File'
}
Original filename: test.pdf
Filename char codes: [
  116, 101, 115,
  116,  46, 112,
  100, 102
]
Decoded filename: test.pdf
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould upload image file with namespace and metadata
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=c4f73846ff452b4addab0ef9c92ddc19',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test.jpg',
  type: 'image/jpeg',
  size: 3,
  lastModified: 1756643965805,
  constructor: 'File'
}
Original filename: test.jpg
Filename char codes: [
  116, 101, 115,
  116,  46, 106,
  112, 103
]
Decoded filename: test.jpg
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould accept PNG files
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=cf84abc3ecacba17c796bd978b30c6d2',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test.png',
  type: 'image/png',
  size: 4,
  lastModified: 1756643965805,
  constructor: 'File'
}
Original filename: test.png
Filename char codes: [
  116, 101, 115,
  116,  46, 112,
  110, 103
]
Decoded filename: test.png
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould accept GIF files
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=d21b435a45cafed247c728b5e78857e1',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test.gif',
  type: 'image/gif',
  size: 3,
  lastModified: 1756643965805,
  constructor: 'File'
}
Original filename: test.gif
Filename char codes: [
  116, 101, 115,
  116,  46, 103,
  105, 102
]
Decoded filename: test.gif
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould accept WebP files
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=46d2f9e70909fd6168dd54ceeee64e53',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test.webp',
  type: 'image/webp',
  size: 4,
  lastModified: 1756643965805,
  constructor: 'File'
}
Original filename: test.webp
Filename char codes: [
  116, 101, 115, 116,
   46, 119, 101,  98,
  112
]
Decoded filename: test.webp
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould reject files over 10MB
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=9c5cc93bf59efce0abe9d4a26ffc8c94',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'large.pdf',
  type: 'application/pdf',
  size: 11534336,
  lastModified: 1756643965805,
  constructor: 'File'
}
Original filename: large.pdf
Filename char codes: [
  108, 97, 114, 103,
  101, 46, 112, 100,
  102
]
Decoded filename: large.pdf
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould reject unsupported file types
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=6969bfa495ea3f267420b103ae27ebd9',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test.txt',
  type: 'text/plain',
  size: 5,
  lastModified: 1756643965805,
  constructor: 'File'
}
Original filename: test.txt
Filename char codes: [
  116, 101, 115,
  116,  46, 116,
  120, 116
]
Decoded filename: test.txt
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould reject invalid metadata JSON
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=71254f59cb5edb83739738307fd2a662',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756643965805,
  constructor: 'File'
}
Original filename: test.pdf
Filename char codes: [
  116, 101, 115,
  116,  46, 112,
  100, 102
]
Decoded filename: test.pdf
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould handle empty metadata
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=992ee3838a8f1ae35c152c97ff5cd119',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756643965805,
  constructor: 'File'
}
Original filename: test.pdf
Filename char codes: [
  116, 101, 115,
  116,  46, 112,
  100, 102
]
Decoded filename: test.pdf
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould handle Durable Object errors
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=4a61c40be50f854b0117cc2715413d93',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756643965805,
  constructor: 'File'
}
Original filename: test.pdf
Filename char codes: [
  116, 101, 115,
  116,  46, 112,
  100, 102
]
Decoded filename: test.pdf
No Japanese characters found in decoded name

[90mstderr[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould handle Durable Object errors
[22m[39mFile upload error: Error: Processing failed
    at /C:/node/vector-db/tests/unit/routes/files/upload.test.ts:221:70
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould handle non-Error exceptions
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=746515d34ddbecbadac39401be9b024c',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756643965805,
  constructor: 'File'
}
Original filename: test.pdf
Filename char codes: [
  116, 101, 115,
  116,  46, 112,
  100, 102
]
Decoded filename: test.pdf
No Japanese characters found in decoded name

[90mstderr[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould handle non-Error exceptions
[22m[39mFile upload error: String error

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould handle file with special characters in name
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=91ea13ead8e66bc0549951eb58c6ae08',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test-file_2024.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756643965805,
  constructor: 'File'
}
Original filename: test-file_2024.pdf
Filename char codes: [
  116, 101, 115, 116,  45, 102,
  105, 108, 101,  95,  50,  48,
   50,  52,  46, 112, 100, 102
]
Decoded filename: test-file_2024.pdf
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould handle Japanese filename with direct Japanese characters
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=a18100c023b0f4e23462bfc203063905',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'テスト文書.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756643965805,
  constructor: 'File'
}
Original filename: テスト文書.pdf
Filename char codes: [
  12486, 12473, 12488,
  25991, 26360,    46,
    112,   100,   102
]
Decoded filename: ƹȇ�.pdf
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould handle filename with percent encoding but no Japanese characters
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=a3d305fa6aabca1a8bd323b625c8cc50',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test%20file.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756643965805,
  constructor: 'File'
}
Original filename: test%20file.pdf
Filename char codes: [
  116, 101, 115, 116,  37,
   50,  48, 102, 105, 108,
  101,  46, 112, 100, 102
]
Decoded filename: test%20file.pdf
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Route[2m > [22m[2mPOST /files/upload[2m > [22m[2mshould handle malformed percent-encoded filename
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=4e6207a6b4c36d31b0808cd6a0607657',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'test%ZZinvalid.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756643965805,
  constructor: 'File'
}
Original filename: test%ZZinvalid.pdf
Filename char codes: [
  116, 101, 115, 116,  37,  90,
   90, 105, 110, 118,  97, 108,
  105, 100,  46, 112, 100, 102
]
Decoded filename: test%ZZinvalid.pdf
No Japanese characters found in decoded name

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Edge Cases[2m > [22m[2mshould handle FormData with non-File value after validation bypass
[22m[39mRequest headers: {
  'content-type': undefined,
  'content-length': undefined,
  'accept-charset': undefined
}

[90mstderr[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Edge Cases[2m > [22m[2mshould handle FormData with non-File value after validation bypass
[22m[39mNot a File object: not-a-file-object

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Edge Cases[2m > [22m[2mshould decode Japanese filename from Latin-1 encoding
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=2ce04470b8e1dc5487ade0f2bb6e9e4a',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'ã\x83\x86ã\x82¹ã\x83\x88æ\x96\x87æ\x9B¸.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756643965805,
  constructor: 'File'
}
Original filename: ãã¹ãææ¸.pdf
Filename char codes: [
  227, 131, 134, 227, 130,
  185, 227, 131, 136, 230,
  150, 135, 230, 155, 184,
   46, 112, 100, 102
]
Decoded filename: テスト文書.pdf
Using decoded filename: テスト文書.pdf

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Edge Cases[2m > [22m[2mshould handle filename decoding errors gracefully
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=d58bf3015f98e50bc69b3ca2fd36a735',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'ã\x82¹ã\x83\x88ÿÿ.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756643965805,
  constructor: 'File'
}
Original filename: ã¹ãÿÿ.pdf
Filename char codes: [
  227, 130, 185, 227,
  131, 136, 255, 255,
   46, 112, 100, 102
]
Decoded filename: スト��.pdf
Using decoded filename: スト��.pdf

[90mstdout[2m | tests/unit/routes/files/upload.test.ts[2m > [22m[2mUpload File Edge Cases[2m > [22m[2mshould handle TextDecoder throwing error on invalid sequences
[22m[39mRequest headers: {
  'content-type': 'multipart/form-data; boundary=2d1c6aa4c74a68f23378abbe25f6c291',
  'content-length': undefined,
  'accept-charset': undefined
}
File object: {
  name: 'ã\x83\x86.pdf',
  type: 'application/pdf',
  size: 4,
  lastModified: 1756643965805,
  constructor: 'File'
}
Original filename: ã.pdf
Filename char codes: [
  227, 131, 134,
   46, 112, 100,
  102
]
Failed to decode filename, using original: ã.pdf Error: Invalid byte sequence
    at Object.<anonymous> (/C:/node/vector-db/tests/unit/routes/files/upload.test.ts:474:15)
    at Object.mockCall (C:/node/vector-db/node_modules/@vitest/spy/dist/index.js:61:17)
    at Object.spy [as decode] (C:/node/vector-db/node_modules/tinyspy/dist/index.js:45:80)
    at FileProcessor.decodeFileName (/C:/node/vector-db/src/routes/api/files/file-processor.ts:603:60)
    at Array.uploadFileHandler (/C:/node/vector-db/src/routes/api/files/upload.ts:688:84)
    at /C:/node/vector-db/tests/unit/routes/files/upload.test.ts:481:22
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)

 [32m✓[39m tests/unit/routes/files/upload.test.ts [2m([22m[2m21 tests[22m[2m)[22m[90m 4[2mms[22m[39m
[90mstderr[2m | tests/unit/durable-objects/notion-manager.test.ts[2m > [22m[2mNotionManager Durable Object[2m > [22m[2mgetWorkflowStatus[2m > [22m[2mshould handle errors gracefully
[22m[39mFailed to get workflow status: Error: Not found
    at /C:/node/vector-db/tests/unit/durable-objects/notion-manager.test.ts:434:72
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

 [32m✓[39m tests/unit/durable-objects/notion-manager.test.ts [2m([22m[2m30 tests[22m[2m)[22m[90m 16[2mms[22m[39m
[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mcreateJob[2m > [22m[2mshould create a vector creation job
[22m[39m{"timestamp":"2025-08-31T12:39:26.103Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.103Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966103_luizr4mif","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.103Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966103_luizr4mif","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.105Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756643966103_luizr4mif","duration":2,"type":"vector:create"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mcreateJob[2m > [22m[2mshould create a vector deletion job
[22m[39m{"timestamp":"2025-08-31T12:39:26.106Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.106Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966106_oyytqd02a","type":"vector:delete","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.106Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966106_oyytqd02a","type":"vector:delete","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.106Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756643966106_oyytqd02a","duration":0,"type":"vector:delete"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mcreateJob[2m > [22m[2mshould create a file processing job
[22m[39m{"timestamp":"2025-08-31T12:39:26.107Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.107Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966107_lk44lxdj1","type":"file:process","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.107Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966107_lk44lxdj1","type":"file:process","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.107Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756643966107_lk44lxdj1","duration":0,"type":"file:process"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mjob processing[2m > [22m[2mshould process vector creation job successfully
[22m[39m{"timestamp":"2025-08-31T12:39:26.108Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.108Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966108_lf1v7ff2j","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.108Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966108_lf1v7ff2j","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.108Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756643966108_lf1v7ff2j","duration":0,"type":"vector:create"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mjob processing[2m > [22m[2mshould handle vector creation job failure
[22m[39m{"timestamp":"2025-08-31T12:39:26.110Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.110Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966110_mn68abgur","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.110Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966110_mn68abgur","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.110Z","level":"ERROR","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job failed: job_vector_1756643966110_mn68abgur","error":{"name":"Error","message":"Workflow failed: Embedding failed","stack":"Error: Workflow failed: Embedding failed\n    at VectorJobManager.waitForWorkflow (/C:/node/vector-db/src/durable-objects/vector-job-manager.ts:1987:17)\n    at VectorJobManager.processCreateVector (/C:/node/vector-db/src/durable-objects/vector-job-manager.ts:1856:56)\n    at /C:/node/vector-db/src/durable-objects/vector-job-manager.ts:1813:14\n    at VectorJobManager.processJob (/C:/node/vector-db/src/base/job-manager.ts:3125:48)"},"type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.110Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Retrying job: job_vector_1756643966110_mn68abgur","attempt":1,"maxRetries":3}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mjob processing[2m > [22m[2mshould process vector deletion job successfully
[22m[39m{"timestamp":"2025-08-31T12:39:26.113Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.113Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966113_6vor9cjw4","type":"vector:delete","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.113Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966113_6vor9cjw4","type":"vector:delete","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.113Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756643966113_6vor9cjw4","duration":0,"type":"vector:delete"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mjob processing[2m > [22m[2mshould process file job successfully
[22m[39m{"timestamp":"2025-08-31T12:39:26.114Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.114Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966114_a5dh1qasi","type":"file:process","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.114Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966114_a5dh1qasi","type":"file:process","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.114Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756643966114_a5dh1qasi","duration":0,"type":"file:process"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mjob processing[2m > [22m[2mshould process delete vectors job successfully
[22m[39m{"timestamp":"2025-08-31T12:39:26.115Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.115Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966115_tcxg2ok61","type":"vector:delete","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.115Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966115_tcxg2ok61","type":"vector:delete","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.115Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756643966115_tcxg2ok61","duration":0,"type":"vector:delete"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mjob processing[2m > [22m[2mshould handle empty vectorIds in delete job
[22m[39m{"timestamp":"2025-08-31T12:39:26.119Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.119Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966119_5yogxy2za","type":"vector:delete","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.119Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966119_5yogxy2za","type":"vector:delete","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.119Z","level":"ERROR","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job failed: job_vector_1756643966119_5yogxy2za","error":{"name":"Error","message":"Vector IDs are required for deletion","stack":"Error: Vector IDs are required for deletion\n    at VectorJobManager.processDeleteVectors (/C:/node/vector-db/src/durable-objects/vector-job-manager.ts:1907:13)\n    at /C:/node/vector-db/src/durable-objects/vector-job-manager.ts:1819:25\n    at VectorJobManager.processJob (/C:/node/vector-db/src/base/job-manager.ts:3125:54)\n    at VectorJobManager.startProcessing (/C:/node/vector-db/src/base/job-manager.ts:3065:16)\n    at VectorJobManager.createJob (/C:/node/vector-db/src/base/job-manager.ts:3011:10)\n    at /C:/node/vector-db/tests/unit/durable-objects/vector-job-manager.test.ts:205:36\n    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)"},"type":"vector:delete","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.119Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Retrying job: job_vector_1756643966119_5yogxy2za","attempt":1,"maxRetries":3}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mjob processing[2m > [22m[2mshould handle missing params in file job
[22m[39m{"timestamp":"2025-08-31T12:39:26.121Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.121Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966121_hd1bc29a2","type":"file:process","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.121Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966121_hd1bc29a2","type":"file:process","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.121Z","level":"ERROR","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job failed: job_vector_1756643966121_hd1bc29a2","error":{"name":"Error","message":"File data and name are required","stack":"Error: File data and name are required\n    at VectorJobManager.processFile (/C:/node/vector-db/src/durable-objects/vector-job-manager.ts:1935:13)\n    at /C:/node/vector-db/src/durable-objects/vector-job-manager.ts:1825:25\n    at VectorJobManager.processJob (/C:/node/vector-db/src/base/job-manager.ts:3125:54)\n    at VectorJobManager.startProcessing (/C:/node/vector-db/src/base/job-manager.ts:3065:16)\n    at VectorJobManager.createJob (/C:/node/vector-db/src/base/job-manager.ts:3011:10)\n    at /C:/node/vector-db/tests/unit/durable-objects/vector-job-manager.test.ts:223:36\n    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)"},"type":"file:process","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.121Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Retrying job: job_vector_1756643966121_hd1bc29a2","attempt":1,"maxRetries":3}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mgetJob[2m > [22m[2mshould return job by ID
[22m[39m{"timestamp":"2025-08-31T12:39:26.123Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.123Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966123_fytov2lkm","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.123Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966123_fytov2lkm","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.124Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756643966123_fytov2lkm","duration":1,"type":"vector:create"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mgetJob[2m > [22m[2mshould return undefined for non-existent job
[22m[39m{"timestamp":"2025-08-31T12:39:26.124Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mgetAllJobs and getJobsByStatus/Type[2m > [22m[2mshould list all jobs
[22m[39m{"timestamp":"2025-08-31T12:39:26.125Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.125Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966125_lk7dbdchq","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.125Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966125_lk7dbdchq","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.125Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966125_m4klgp6ry","type":"vector:delete","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.126Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756643966125_lk7dbdchq","duration":1,"type":"vector:create"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mgetAllJobs and getJobsByStatus/Type[2m > [22m[2mshould filter jobs by status
[22m[39m{"timestamp":"2025-08-31T12:39:26.126Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.126Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966126_vzyatmkiw","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.126Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966126_vzyatmkiw","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.126Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966126_9xj7nstnt","type":"vector:delete","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.127Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756643966126_vzyatmkiw","duration":1,"type":"vector:create"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mgetAllJobs and getJobsByStatus/Type[2m > [22m[2mshould filter jobs by type
[22m[39m{"timestamp":"2025-08-31T12:39:26.127Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.127Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966127_0uefkcl2z","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.127Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966127_0uefkcl2z","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.127Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966127_6r5i40e3x","type":"vector:delete","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.127Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966127_8h244cv5b","type":"file:process","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.127Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756643966127_0uefkcl2z","duration":0,"type":"vector:create"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mcancelJob[2m > [22m[2mshould cancel a queued job
[22m[39m{"timestamp":"2025-08-31T12:39:26.128Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.128Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966128_4gcy7ufw6","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.128Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966128_4gcy7ufw6","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.128Z","level":"WARN","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Cannot cancel job with status processing: job_vector_1756643966128_4gcy7ufw6"}}
{"timestamp":"2025-08-31T12:39:26.129Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756643966128_4gcy7ufw6","duration":1,"type":"vector:create"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mcancelJob[2m > [22m[2mshould not cancel a completed job
[22m[39m{"timestamp":"2025-08-31T12:39:26.130Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.130Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966130_e6c6fjadb","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.130Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966130_e6c6fjadb","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.130Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756643966130_e6c6fjadb","duration":0,"type":"vector:create"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mcancelJob[2m > [22m[2mshould not cancel a completed job
[22m[39m{"timestamp":"2025-08-31T12:39:26.140Z","level":"WARN","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Cannot cancel job with status completed: job_vector_1756643966130_e6c6fjadb"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mworkflow timeout[2m > [22m[2mshould handle workflow timeout
[22m[39m{"timestamp":"2025-08-31T12:39:26.131Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.131Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966131_rxe9rjca1","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.131Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966131_rxe9rjca1","type":"vector:create","retryCount":0}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mworkflow timeout[2m > [22m[2mshould handle workflow timeout
[22m[39m{"timestamp":"2025-08-31T12:39:56.131Z","level":"ERROR","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job failed: job_vector_1756643966131_rxe9rjca1","error":{"name":"Error","message":"Workflow did not complete within timeout","stack":"Error: Workflow did not complete within timeout\n    at VectorJobManager.waitForWorkflow (/C:/node/vector-db/src/durable-objects/vector-job-manager.ts:2002:11)\n    at VectorJobManager.processCreateVector (/C:/node/vector-db/src/durable-objects/vector-job-manager.ts:1856:56)\n    at /C:/node/vector-db/src/durable-objects/vector-job-manager.ts:1813:14\n    at VectorJobManager.processJob (/C:/node/vector-db/src/base/job-manager.ts:3125:48)"},"type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T12:39:56.131Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Retrying job: job_vector_1756643966131_rxe9rjca1","attempt":1,"maxRetries":3}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mclearJobs[2m > [22m[2mshould clear all jobs
[22m[39m{"timestamp":"2025-08-31T12:39:26.152Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.152Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966152_841872j0d","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.152Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966152_841872j0d","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.152Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966152_6qwbew0bq","type":"vector:delete","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.152Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Cleared 2 jobs","onlyCompleted":false}}
{"timestamp":"2025-08-31T12:39:26.153Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756643966152_841872j0d","duration":1,"type":"vector:create"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mgetStatistics[2m > [22m[2mshould return job statistics
[22m[39m{"timestamp":"2025-08-31T12:39:26.154Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.154Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966154_r01p8ij4a","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.154Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966154_r01p8ij4a","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.154Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966154_6klssy1x4","type":"vector:delete","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.154Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966154_hpv3hyau5","type":"file:process","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.154Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756643966154_r01p8ij4a","duration":0,"type":"vector:create"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mcleanupOldJobs[2m > [22m[2mshould remove completed jobs older than retention period
[22m[39m{"timestamp":"2025-08-31T12:39:26.155Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.155Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1700000000000_g6ejqpggu","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.155Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1700000000000_g6ejqpggu","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.155Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1700000000000_sgxtqiyj0","type":"vector:delete","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.155Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1700000000000_g6ejqpggu","duration":0,"type":"vector:create"}}
{"timestamp":"2025-08-31T12:39:26.165Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1700000000000_sgxtqiyj0","type":"vector:delete","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.165Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1700000000000_sgxtqiyj0","duration":0,"type":"vector:delete"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mcleanupOldJobs[2m > [22m[2mshould remove completed jobs older than retention period
[22m[39m{"timestamp":"2025-08-31T12:39:26.175Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Cleaned up 1 old jobs","olderThanHours":24}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mcleanupOldJobs[2m > [22m[2mshould not remove active jobs
[22m[39m{"timestamp":"2025-08-31T12:39:26.157Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Config updated","pollInterval":10}}
{"timestamp":"2025-08-31T12:39:26.157Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966157_bj03swzoc","type":"vector:create","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.157Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966157_bj03swzoc","type":"vector:create","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.157Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job created","jobId":"job_vector_1756643966157_o0lcu7bds","type":"vector:delete","priority":"NORMAL"}}
{"timestamp":"2025-08-31T12:39:26.157Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756643966157_bj03swzoc","duration":0,"type":"vector:create"}}
{"timestamp":"2025-08-31T12:39:26.167Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Processing job: job_vector_1756643966157_o0lcu7bds","type":"vector:delete","retryCount":0}}
{"timestamp":"2025-08-31T12:39:26.167Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Job completed: job_vector_1756643966157_o0lcu7bds","duration":0,"type":"vector:delete"}}

[90mstdout[2m | tests/unit/durable-objects/vector-job-manager.test.ts[2m > [22m[2mVectorJobManager[2m > [22m[2mcleanupOldJobs[2m > [22m[2mshould not remove active jobs
[22m[39m{"timestamp":"2025-08-31T12:39:26.177Z","level":"INFO","method":"","path":"","metadata":{"context":"JobManager:vector","message":"Cleaned up 0 old jobs","olderThanHours":24}}

 [32m✓[39m tests/unit/durable-objects/vector-job-manager.test.ts [2m([22m[2m22 tests[22m[2m)[22m[90m 3[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/notion/list-pages.test.ts[2m > [22m[2mList Notion Pages Route[2m > [22m[2mGET /notion/pages[2m > [22m[2mshould handle errors
[22m[39mList pages error: Error: Notion API error
    at /C:/node/vector-db/tests/unit/routes/notion/list-pages.test.ts:313:63
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/routes/notion/list-pages.test.ts[2m > [22m[2mList Notion Pages Route[2m > [22m[2mGET /notion/pages[2m > [22m[2mshould handle non-Error exceptions
[22m[39mList pages error: String error

 [32m✓[39m tests/unit/routes/notion/list-pages.test.ts [2m([22m[2m17 tests[22m[2m)[22m[90m 9[2mms[22m[39m
 [32m✓[39m tests/unit/base/job-manager.test.ts [2m([22m[2m26 tests[22m[2m)[22m[90m 6[2mms[22m[39m
 [32m✓[39m tests/unit/durable-objects/notion-sync-manager.test.ts [2m([22m[2m33 tests[22m[2m)[22m[90m 33[2mms[22m[39m
 [32m✓[39m tests/unit/workflows/notion-sync-run.test.ts [2m([22m[2m15 tests[22m[2m)[22m[90m 20[2mms[22m[39m
[90mstderr[2m | tests/unit/workflows/property-handlers.test.ts[2m > [22m[2mPropertyHandlers[2m > [22m[2mextractText[2m > [22m[2mshould handle extraction errors gracefully
[22m[39mFailed to extract text from property: Cannot read properties of null (reading 'map')

[90mstderr[2m | tests/unit/workflows/property-handlers.test.ts[2m > [22m[2mPropertyHandlers[2m > [22m[2mprocessProperties[2m > [22m[2mshould skip unsupported property types
[22m[39mSkipping unsupported property type: unsupported_relation

[90mstderr[2m | tests/unit/workflows/property-handlers.test.ts[2m > [22m[2mPropertyHandlers[2m > [22m[2mprocessProperties[2m > [22m[2mshould handle property processing errors gracefully
[22m[39mSkipping unsupported property type: invalid_property

 [32m✓[39m tests/unit/workflows/property-handlers.test.ts [2m([22m[2m37 tests[22m[2m)[22m[90m 7[2mms[22m[39m
 [32m✓[39m tests/unit/base/workflow.test.ts [2m([22m[2m27 tests[22m[2m)[22m[90m 25[2mms[22m[39m
 [32m✓[39m tests/unit/middleware/validation.test.ts [2m([22m[2m28 tests[22m[2m)[22m[90m 32[2mms[22m[39m
[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mGET /search/semantic[2m > [22m[2mshould perform semantic search successfully
[22m[39m[2025-08-31T12:39:26.910Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Starting semantic search',
    query: 'test search query',
    topK: 5,
    namespace: undefined
  }
}
[2025-08-31T12:39:26.911Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Semantic search completed',
    resultCount: 2,
    processingTime: 1
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mGET /search/semantic[2m > [22m[2mshould handle search with namespace
[22m[39m[2025-08-31T12:39:26.913Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Starting semantic search',
    query: 'namespace search',
    topK: 10,
    namespace: 'test-namespace'
  }
}
[2025-08-31T12:39:26.913Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Semantic search completed',
    resultCount: 1,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mGET /search/semantic[2m > [22m[2mshould use default topK when not provided
[22m[39m[2025-08-31T12:39:26.914Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Starting semantic search',
    query: 'minimal search',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T12:39:26.914Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Semantic search completed',
    resultCount: 0,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mGET /search/semantic[2m > [22m[2mshould handle AI embedding generation failure
[22m[39m[2025-08-31T12:39:26.920Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Starting semantic search',
    query: 'test query',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T12:39:26.920Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Unexpected semantic search error',
    error: {
      name: 'Error',
      message: 'Failed to generate embedding for query',
      stack: 'Error: Failed to generate embedding for query\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/semantic.test.ts:149:42\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    },
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mGET /search/semantic[2m > [22m[2mshould handle AI run without data property
[22m[39m[2025-08-31T12:39:26.921Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Starting semantic search',
    query: 'test query',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T12:39:26.922Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Unexpected semantic search error',
    error: {
      name: 'Error',
      message: 'Failed to generate embedding for query',
      stack: 'Error: Failed to generate embedding for query\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/semantic.test.ts:160:42\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    },
    processingTime: 1
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mGET /search/semantic[2m > [22m[2mshould handle vectorize query errors
[22m[39m[2025-08-31T12:39:26.923Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Starting semantic search',
    query: 'error test',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T12:39:26.923Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Unexpected semantic search error',
    error: {
      name: 'Error',
      message: 'Vectorize search failed',
      stack: 'Error: Vectorize search failed\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/semantic.test.ts:170:42\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    },
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mGET /search/semantic[2m > [22m[2mshould handle non-Error exceptions
[22m[39m[2025-08-31T12:39:26.924Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Starting semantic search',
    query: 'non-error test',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T12:39:26.924Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Unexpected semantic search error',
    error: 'String error',
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mGET /search/semantic[2m > [22m[2mshould handle empty search results
[22m[39m[2025-08-31T12:39:26.925Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Starting semantic search',
    query: 'no results',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T12:39:26.925Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Semantic search completed',
    resultCount: 0,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mGET /search/semantic[2m > [22m[2mshould handle special characters in query
[22m[39m[2025-08-31T12:39:26.926Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Starting semantic search',
    query: 'special&chars+test',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T12:39:26.927Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearch',
    message: 'Semantic search completed',
    resultCount: 1,
    processingTime: 1
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mPOST /search/semantic[2m > [22m[2mshould perform semantic search successfully with POST
[22m[39m[2025-08-31T12:39:26.928Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearchPost',
    message: 'Starting semantic search (POST)',
    query: 'test post search query',
    topK: 8,
    namespace: 'test-namespace'
  }
}
[2025-08-31T12:39:26.928Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearchPost',
    message: 'Semantic search (POST) completed',
    resultCount: 2,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mPOST /search/semantic[2m > [22m[2mshould handle POST request without namespace
[22m[39m[2025-08-31T12:39:26.929Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearchPost',
    message: 'Starting semantic search (POST)',
    query: 'simple post query',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T12:39:26.930Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearchPost',
    message: 'Semantic search (POST) completed',
    resultCount: 0,
    processingTime: 1
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mPOST /search/semantic[2m > [22m[2mshould handle AI error in POST request
[22m[39m[2025-08-31T12:39:26.935Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearchPost',
    message: 'Starting semantic search (POST)',
    query: 'error test query',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T12:39:26.935Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SemanticSearchPost',
    message: 'Unexpected semantic search (POST) error',
    error: {
      name: 'Error',
      message: 'AI service error',
      stack: 'Error: AI service error\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/semantic.test.ts:290:42\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    },
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mPOST /search/semantic[2m > [22m[2mshould handle vectorize error in POST request
[22m[39m[2025-08-31T12:39:26.937Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearchPost',
    message: 'Starting semantic search (POST)',
    query: 'vectorize error test',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T12:39:26.937Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SemanticSearchPost',
    message: 'Unexpected semantic search (POST) error',
    error: {
      name: 'Error',
      message: 'Vectorize error',
      stack: 'Error: Vectorize error\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/semantic.test.ts:305:42\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    },
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mPOST /search/semantic[2m > [22m[2mshould handle AppError with custom status code in POST
[22m[39m[2025-08-31T12:39:26.942Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearchPost',
    message: 'Starting semantic search (POST)',
    query: 'app error test',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T12:39:26.943Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SemanticSearchPost',
    message: 'Semantic search (POST) failed with AppError',
    error: {
      name: 'AppError',
      message: 'Custom search error',
      stack: 'AppError: Custom search error\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/semantic.test.ts:354:9\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)\n' +
        '    at C:/node/vector-db/node_modules/vitest/dist/chunks/runBaseTests.3qpJUEJM.js:126:11\n' +
        '    at withEnv (C:/node/vector-db/node_modules/vitest/dist/chunks/runBaseTests.3qpJUEJM.js:90:5)'
    },
    code: 'SEARCH_ERROR',
    statusCode: 403,
    processingTime: 1
  }
}

[90mstdout[2m | tests/unit/routes/search/semantic.test.ts[2m > [22m[2mSemantic Search Route[2m > [22m[2mPOST /search/semantic[2m > [22m[2mshould handle non-Error exception in POST
[22m[39m[2025-08-31T12:39:26.944Z] INFO   - 
  Details: {
  metadata: {
    context: 'SemanticSearchPost',
    message: 'Starting semantic search (POST)',
    query: 'non-error test',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T12:39:26.944Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SemanticSearchPost',
    message: 'Unexpected semantic search (POST) error',
    error: 'String error',
    processingTime: 0
  }
}

 [32m✓[39m tests/unit/routes/search/semantic.test.ts [2m([22m[2m23 tests[22m[2m)[22m[90m 3[2mms[22m[39m
 [32m✓[39m tests/unit/workflows/sync-state-machine.test.ts [2m([22m[2m32 tests[22m[2m)[22m[90m 40[2mms[22m[39m
[90mstdout[2m | tests/unit/workflows/vector-generator.test.ts[2m > [22m[2mVectorGenerator Workflow[2m > [22m[2mexecute (via run)[2m > [22m[2mshould generate vectors for all chunks
[22m[39m[2025-08-31T12:39:27.172Z] INFO   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Workflow started',
    params: {
      chunks: [Array],
      namespace: 'test-namespace',
      model: '@cf/baai/bge-base-en-v1.5'
    },
    timestamp: '2025-08-31T12:39:27.172Z'
  }
}
[2025-08-31T12:39:27.172Z] INFO   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Starting vector generation',
    chunks: 3,
    namespace: 'test-namespace',
    model: '@cf/baai/bge-base-en-v1.5'
  }
}
[2025-08-31T12:39:27.172Z] INFO   - 
  Details: {
  metadata: { context: 'VectorGenerator', message: 'Processing 1 batches' }
}
[2025-08-31T12:39:27.172Z] INFO   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Processing batch-1-of-1',
    current: 1,
    total: 1
  }
}
[2025-08-31T12:39:27.173Z] DEBUG   - 
  Details: {
  metadata: { context: 'VectorGenerator', message: 'Step started: batch-1-of-1' }
}
[2025-08-31T12:39:27.173Z] DEBUG   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Vector saved',
    id: 'chunk-1',
    namespace: 'test-namespace'
  }
}
[2025-08-31T12:39:27.173Z] DEBUG   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Vector saved',
    id: 'chunk-2',
    namespace: 'test-namespace'
  }
}
[2025-08-31T12:39:27.173Z] DEBUG   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Vector saved',
    id: 'chunk-3',
    namespace: 'test-namespace'
  }
}
[2025-08-31T12:39:27.173Z] DEBUG   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Step completed: batch-1-of-1'
  }
}
[2025-08-31T12:39:27.173Z] INFO   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Vector generation completed',
    totalVectors: 3,
    failedChunks: 0,
    successRate: '100%'
  }
}
[2025-08-31T12:39:27.173Z] INFO   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Workflow completed',
    duration: 1,
    result: {
      vectorIds: [Array],
      totalVectors: 3,
      failedChunks: 0,
      metadata: [Object]
    }
  }
}

[90mstdout[2m | tests/unit/workflows/vector-generator.test.ts[2m > [22m[2mVectorGenerator Workflow[2m > [22m[2mexecute (via run)[2m > [22m[2mshould handle empty chunks array
[22m[39m[2025-08-31T12:39:27.174Z] INFO   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Workflow started',
    params: { chunks: [], namespace: 'test-namespace' },
    timestamp: '2025-08-31T12:39:27.174Z'
  }
}
[2025-08-31T12:39:27.174Z] INFO   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Starting vector generation',
    chunks: 0,
    namespace: 'test-namespace',
    model: undefined
  }
}
[2025-08-31T12:39:27.174Z] WARN   - 
  Details: {
  metadata: { context: 'VectorGenerator', message: 'No chunks to process' }
}
[2025-08-31T12:39:27.174Z] INFO   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Workflow completed',
    duration: 0,
    result: { vectorIds: [], totalVectors: 0, failedChunks: 0 }
  }
}

[90mstdout[2m | tests/unit/workflows/vector-generator.test.ts[2m > [22m[2mVectorGenerator Workflow[2m > [22m[2mexecute (via run)[2m > [22m[2mshould handle undefined chunks
[22m[39m[2025-08-31T12:39:27.175Z] INFO   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Workflow started',
    params: { chunks: undefined, namespace: 'test-namespace' },
    timestamp: '2025-08-31T12:39:27.175Z'
  }
}
[2025-08-31T12:39:27.175Z] INFO   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Starting vector generation',
    chunks: 0,
    namespace: 'test-namespace',
    model: undefined
  }
}
[2025-08-31T12:39:27.175Z] WARN   - 
  Details: {
  metadata: { context: 'VectorGenerator', message: 'No chunks to process' }
}
[2025-08-31T12:39:27.175Z] INFO   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Workflow completed',
    duration: 0,
    result: { vectorIds: [], totalVectors: 0, failedChunks: 0 }
  }
}

[90mstdout[2m | tests/unit/workflows/vector-generator.test.ts[2m > [22m[2mVectorGenerator Workflow[2m > [22m[2mexecute (via run)[2m > [22m[2mshould handle embedding generation failures
[22m[39m[2025-08-31T12:39:27.175Z] INFO   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Workflow started',
    params: { chunks: [Array], namespace: 'test-namespace' },
    timestamp: '2025-08-31T12:39:27.175Z'
  }
}
[2025-08-31T12:39:27.176Z] INFO   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Starting vector generation',
    chunks: 3,
    namespace: 'test-namespace',
    model: undefined
  }
}
[2025-08-31T12:39:27.176Z] INFO   - 
  Details: {
  metadata: { context: 'VectorGenerator', message: 'Processing 1 batches' }
}
[2025-08-31T12:39:27.176Z] INFO   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Processing batch-1-of-1',
    current: 1,
    total: 1
  }
}
[2025-08-31T12:39:27.176Z] DEBUG   - 
  Details: {
  metadata: { context: 'VectorGenerator', message: 'Step started: batch-1-of-1' }
}
[2025-08-31T12:39:27.176Z] ERROR   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Embedding generation failed',
    error: {
      name: 'Error',
      message: 'Embedding failed',
      stack: 'Error: Embedding failed\n' +
        '    at /C:/node/vector-db/tests/unit/workflows/vector-generator.test.ts:116:93\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    }
  }
}
[2025-08-31T12:39:27.176Z] DEBUG   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Vector saved',
    id: 'chunk-1',
    namespace: 'test-namespace'
  }
}
[2025-08-31T12:39:27.176Z] DEBUG   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Vector saved',
    id: 'chunk-3',
    namespace: 'test-namespace'
  }
}
[2025-08-31T12:39:27.176Z] ERROR   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Chunk vector generation failed',
    error: {
      name: 'Error',
      message: 'Failed to generate embedding: Embedding failed',
      stack: 'Error: Failed to generate embedding: Embedding failed\n' +
        '    at VectorGenerator.generateVectorForChunk (/C:/node/vector-db/src/workflows/vector-generator.ts:2185:13)\n' +
        '    at async Promise.allSettled (index 1)\n' +
        '    at VectorGenerator.processBatch (/C:/node/vector-db/src/workflows/vector-generator.ts:2147:47)'
    }
  }
}
[2025-08-31T12:39:27.177Z] DEBUG   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Step completed: batch-1-of-1'
  }
}
[2025-08-31T12:39:27.177Z] INFO   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Vector generation completed',
    totalVectors: 2,
    failedChunks: 1,
    successRate: '67%'
  }
}
[2025-08-31T12:39:27.177Z] INFO   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Workflow completed',
    duration: 2,
    result: {
      vectorIds: [Array],
      totalVectors: 2,
      failedChunks: 1,
      metadata: [Object]
    }
  }
}

[90mstdout[2m | tests/unit/workflows/vector-generator.test.ts[2m > [22m[2mVectorGenerator Workflow[2m > [22m[2mdetermineBatchSize[2m > [22m[2mshould limit to maximum batch size
[22m[39m[2025-08-31T12:39:27.178Z] WARN   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Batch size too large, using maximum: 10'
  }
}

[90mstdout[2m | tests/unit/workflows/vector-generator.test.ts[2m > [22m[2mVectorGenerator Workflow[2m > [22m[2mdetermineBatchSize[2m > [22m[2mshould use default for invalid sizes
[22m[39m[2025-08-31T12:39:27.178Z] WARN   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Invalid batch size, using default'
  }
}

[90mstdout[2m | tests/unit/workflows/vector-generator.test.ts[2m > [22m[2mVectorGenerator Workflow[2m > [22m[2mgenerateEmbedding[2m > [22m[2mshould handle unexpected response format
[22m[39m[2025-08-31T12:39:27.181Z] ERROR   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Embedding generation failed',
    error: {
      name: 'Error',
      message: 'Unexpected embedding response format',
      stack: 'Error: Unexpected embedding response format\n' +
        '    at VectorGenerator.generateEmbedding (/C:/node/vector-db/src/workflows/vector-generator.ts:2251:13)\n' +
        '    at /C:/node/vector-db/tests/unit/workflows/vector-generator.test.ts:201:22\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)\n' +
        '    at C:/node/vector-db/node_modules/vitest/dist/chunks/runBaseTests.3qpJUEJM.js:126:11'
    }
  }
}

[90mstdout[2m | tests/unit/workflows/vector-generator.test.ts[2m > [22m[2mVectorGenerator Workflow[2m > [22m[2mgenerateEmbedding[2m > [22m[2mshould handle AI service errors
[22m[39m[2025-08-31T12:39:27.182Z] ERROR   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Embedding generation failed',
    error: {
      name: 'Error',
      message: 'AI service unavailable',
      stack: 'Error: AI service unavailable\n' +
        '    at /C:/node/vector-db/tests/unit/workflows/vector-generator.test.ts:207:50\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    }
  }
}

[90mstdout[2m | tests/unit/workflows/vector-generator.test.ts[2m > [22m[2mVectorGenerator Workflow[2m > [22m[2mgenerateEmbedding[2m > [22m[2mshould handle non-Error exceptions
[22m[39m[2025-08-31T12:39:27.183Z] ERROR   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Embedding generation failed',
    error: 'String error'
  }
}

[90mstdout[2m | tests/unit/workflows/vector-generator.test.ts[2m > [22m[2mVectorGenerator Workflow[2m > [22m[2msaveVector[2m > [22m[2mshould save vector successfully
[22m[39m[2025-08-31T12:39:27.183Z] DEBUG   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Vector saved',
    id: 'test-vector',
    namespace: 'test'
  }
}

[90mstdout[2m | tests/unit/workflows/vector-generator.test.ts[2m > [22m[2mVectorGenerator Workflow[2m > [22m[2msaveVector[2m > [22m[2mshould handle vectorize errors
[22m[39m[2025-08-31T12:39:27.184Z] ERROR   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Failed to save vector',
    error: {
      name: 'Error',
      message: 'Vectorize error',
      stack: 'Error: Vectorize error\n' +
        '    at /C:/node/vector-db/tests/unit/workflows/vector-generator.test.ts:233:66\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    },
    vectorId: 'test-vector'
  }
}
[2025-08-31T12:39:27.184Z] ERROR   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Failed to save vector',
    error: {
      name: 'Error',
      message: 'Vectorize error',
      stack: 'Error: Vectorize error\n' +
        '    at /C:/node/vector-db/tests/unit/workflows/vector-generator.test.ts:233:66\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    },
    vectorId: 'test-vector'
  }
}

[90mstdout[2m | tests/unit/workflows/vector-generator.test.ts[2m > [22m[2mVectorGenerator Workflow[2m > [22m[2maggregateResults[2m > [22m[2mshould aggregate successful results
[22m[39m[2025-08-31T12:39:27.184Z] INFO   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Vector generation completed',
    totalVectors: 5,
    failedChunks: 1,
    successRate: '83%'
  }
}

[90mstdout[2m | tests/unit/workflows/vector-generator.test.ts[2m > [22m[2mVectorGenerator Workflow[2m > [22m[2maggregateResults[2m > [22m[2mshould handle all failed results
[22m[39m[2025-08-31T12:39:27.185Z] INFO   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Vector generation completed',
    totalVectors: 0,
    failedChunks: 3,
    successRate: '0%'
  }
}

[90mstdout[2m | tests/unit/workflows/vector-generator.test.ts[2m > [22m[2mVectorGenerator Workflow[2m > [22m[2maggregateResults[2m > [22m[2mshould handle empty results
[22m[39m[2025-08-31T12:39:27.185Z] INFO   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Vector generation completed',
    totalVectors: 0,
    failedChunks: 0,
    successRate: '0%'
  }
}

[90mstdout[2m | tests/unit/workflows/vector-generator.test.ts[2m > [22m[2mVectorGenerator Workflow[2m > [22m[2mprocessBatch[2m > [22m[2mshould process all chunks in batch successfully
[22m[39m[2025-08-31T12:39:27.186Z] DEBUG   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Vector saved',
    id: 'chunk-1',
    namespace: 'test'
  }
}
[2025-08-31T12:39:27.186Z] DEBUG   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Vector saved',
    id: 'chunk-2',
    namespace: 'test'
  }
}

[90mstdout[2m | tests/unit/workflows/vector-generator.test.ts[2m > [22m[2mVectorGenerator Workflow[2m > [22m[2mprocessBatch[2m > [22m[2mshould handle mixed success and failure in batch
[22m[39m[2025-08-31T12:39:27.187Z] ERROR   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Embedding generation failed',
    error: {
      name: 'Error',
      message: 'Failed',
      stack: 'Error: Failed\n' +
        '    at /C:/node/vector-db/tests/unit/workflows/vector-generator.test.ts:291:93\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    }
  }
}
[2025-08-31T12:39:27.187Z] DEBUG   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Vector saved',
    id: 'chunk-1',
    namespace: 'test'
  }
}
[2025-08-31T12:39:27.187Z] ERROR   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Chunk vector generation failed',
    error: {
      name: 'Error',
      message: 'Failed to generate embedding: Failed',
      stack: 'Error: Failed to generate embedding: Failed\n' +
        '    at VectorGenerator.generateVectorForChunk (/C:/node/vector-db/src/workflows/vector-generator.ts:2185:13)\n' +
        '    at async Promise.allSettled (index 1)\n' +
        '    at VectorGenerator.processBatch (/C:/node/vector-db/src/workflows/vector-generator.ts:2147:47)\n' +
        '    at /C:/node/vector-db/tests/unit/workflows/vector-generator.test.ts:297:22\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)'
    }
  }
}

[90mstdout[2m | tests/unit/workflows/vector-generator.test.ts[2m > [22m[2mVectorGenerator Workflow[2m > [22m[2mgenerateVectorForChunk[2m > [22m[2mshould generate vector for chunk successfully
[22m[39m[2025-08-31T12:39:27.187Z] DEBUG   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Vector saved',
    id: 'chunk-1',
    namespace: 'test'
  }
}

[90mstdout[2m | tests/unit/workflows/vector-generator.test.ts[2m > [22m[2mVectorGenerator Workflow[2m > [22m[2mgenerateVectorForChunk[2m > [22m[2mshould handle embedding generation failure
[22m[39m[2025-08-31T12:39:27.188Z] ERROR   - 
  Details: {
  metadata: {
    context: 'VectorGenerator',
    message: 'Embedding generation failed',
    error: {
      name: 'Error',
      message: 'Embedding failed',
      stack: 'Error: Embedding failed\n' +
        '    at /C:/node/vector-db/tests/unit/workflows/vector-generator.test.ts:330:50\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    }
  }
}

 [32m✓[39m tests/unit/workflows/vector-generator.test.ts [2m([22m[2m28 tests[22m[2m)[22m[90m 3[2mms[22m[39m
[90mstdout[2m | tests/unit/routes/embeddings/models.test.ts[2m > [22m[2mList Models Route[2m > [22m[2mGET /embeddings/models[2m > [22m[2mshould list available models successfully
[22m[39m[2025-08-31T12:39:27.266Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Fetching available embedding models'
  }
}
[2025-08-31T12:39:27.266Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Successfully fetched models',
    modelsCount: 3,
    defaultModel: '@cf/baai/bge-base-en-v1.5'
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/models.test.ts[2m > [22m[2mList Models Route[2m > [22m[2mGET /embeddings/models[2m > [22m[2mshould handle empty models list
[22m[39m[2025-08-31T12:39:27.268Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Fetching available embedding models'
  }
}
[2025-08-31T12:39:27.268Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Successfully fetched models',
    modelsCount: 0,
    defaultModel: '@cf/baai/bge-base-en-v1.5'
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/models.test.ts[2m > [22m[2mList Models Route[2m > [22m[2mGET /embeddings/models[2m > [22m[2mshould handle Durable Object errors
[22m[39m[2025-08-31T12:39:27.270Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Fetching available embedding models'
  }
}
[2025-08-31T12:39:27.270Z] ERROR   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Unexpected error fetching models',
    error: {
      name: 'Error',
      message: 'Failed to fetch models',
      stack: 'Error: Failed to fetch models\n' +
        '    at /C:/node/vector-db/tests/unit/routes/embeddings/models.test.ts:123:65\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    }
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/models.test.ts[2m > [22m[2mList Models Route[2m > [22m[2mGET /embeddings/models[2m > [22m[2mshould handle non-Error exceptions
[22m[39m[2025-08-31T12:39:27.271Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Fetching available embedding models'
  }
}
[2025-08-31T12:39:27.271Z] ERROR   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Unexpected error fetching models',
    error: 'Unknown error'
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/models.test.ts[2m > [22m[2mList Models Route[2m > [22m[2mGET /embeddings/models[2m > [22m[2mshould handle network timeouts
[22m[39m[2025-08-31T12:39:27.274Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Fetching available embedding models'
  }
}
[2025-08-31T12:39:27.275Z] ERROR   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Unexpected error fetching models',
    error: {
      name: 'Error',
      message: 'Request timeout',
      stack: 'Error: Request timeout\n' +
        '    at /C:/node/vector-db/tests/unit/routes/embeddings/models.test.ts:147:65\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    }
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/models.test.ts[2m > [22m[2mList Models Route[2m > [22m[2mGET /embeddings/models[2m > [22m[2mshould handle AppError with custom code
[22m[39m[2025-08-31T12:39:27.277Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Fetching available embedding models'
  }
}
[2025-08-31T12:39:27.277Z] ERROR   - 
  Details: {
  metadata: {
    context: 'GetEmbeddingModels',
    message: 'Failed to get models with AppError',
    error: {
      name: 'AppError',
      message: 'Custom error message',
      stack: 'AppError: Custom error message\n' +
        '    at /C:/node/vector-db/tests/unit/routes/embeddings/models.test.ts:159:9\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)\n' +
        '    at C:/node/vector-db/node_modules/vitest/dist/chunks/runBaseTests.3qpJUEJM.js:126:11\n' +
        '    at withEnv (C:/node/vector-db/node_modules/vitest/dist/chunks/runBaseTests.3qpJUEJM.js:90:5)'
    },
    code: 'CUSTOM_ERROR',
    statusCode: 500
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/models.test.ts[2m > [22m[2mList Models Route[2m > [22m[2mGET /embeddings/models/{modelId}[2m > [22m[2mshould get model details successfully
[22m[39m[2025-08-31T12:39:27.279Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetModelDetails',
    message: 'Fetching model details',
    modelId: '@cf/baai/bge-base-en-v1.5'
  }
}
[2025-08-31T12:39:27.279Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetModelDetails',
    message: 'Successfully fetched model details',
    modelId: '@cf/baai/bge-base-en-v1.5'
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/models.test.ts[2m > [22m[2mList Models Route[2m > [22m[2mGET /embeddings/models/{modelId}[2m > [22m[2mshould return 404 for non-existent model
[22m[39m[2025-08-31T12:39:27.281Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetModelDetails',
    message: 'Fetching model details',
    modelId: 'non-existent-model'
  }
}
[2025-08-31T12:39:27.281Z] ERROR   - 
  Details: {
  metadata: {
    context: 'GetModelDetails',
    message: 'Failed to get model details with AppError',
    error: {
      name: 'AppError',
      message: 'Model not found: non-existent-model',
      stack: 'AppError: Model not found: non-existent-model\n' +
        '    at getModelDetailsHandler (/C:/node/vector-db/src/routes/api/embeddings/models.ts:1075:13)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/embeddings/models.test.ts:225:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)'
    },
    code: 'MODEL_NOT_FOUND',
    statusCode: 404,
    modelId: 'non-existent-model'
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/models.test.ts[2m > [22m[2mList Models Route[2m > [22m[2mGET /embeddings/models/{modelId}[2m > [22m[2mshould handle embedding service errors
[22m[39m[2025-08-31T12:39:27.282Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetModelDetails',
    message: 'Fetching model details',
    modelId: '@cf/baai/bge-base-en-v1.5'
  }
}
[2025-08-31T12:39:27.282Z] ERROR   - 
  Details: {
  metadata: {
    context: 'GetModelDetails',
    message: 'Unexpected error fetching model details',
    error: {
      name: 'TypeError',
      message: "Cannot read properties of undefined (reading 'models')",
      stack: "TypeError: Cannot read properties of undefined (reading 'models')\n" +
        '    at getModelDetailsHandler (/C:/node/vector-db/src/routes/api/embeddings/models.ts:1066:56)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/embeddings/models.test.ts:237:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)'
    },
    modelId: '@cf/baai/bge-base-en-v1.5'
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/models.test.ts[2m > [22m[2mList Models Route[2m > [22m[2mGET /embeddings/models/{modelId}[2m > [22m[2mshould handle AppError with MODEL_NOT_FOUND in getModelDetails
[22m[39m[2025-08-31T12:39:27.284Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetModelDetails',
    message: 'Fetching model details',
    modelId: 'test-model'
  }
}
[2025-08-31T12:39:27.285Z] ERROR   - 
  Details: {
  metadata: {
    context: 'GetModelDetails',
    message: 'Failed to get model details with AppError',
    error: {
      name: 'AppError',
      message: 'Model not found: test-model',
      stack: 'AppError: Model not found: test-model\n' +
        '    at /C:/node/vector-db/tests/unit/routes/embeddings/models.test.ts:246:9\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)\n' +
        '    at C:/node/vector-db/node_modules/vitest/dist/chunks/runBaseTests.3qpJUEJM.js:126:11\n' +
        '    at withEnv (C:/node/vector-db/node_modules/vitest/dist/chunks/runBaseTests.3qpJUEJM.js:90:5)'
    },
    code: 'MODEL_NOT_FOUND',
    statusCode: 404,
    modelId: 'test-model'
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/models.test.ts[2m > [22m[2mList Models Route[2m > [22m[2mGET /embeddings/models/{modelId}[2m > [22m[2mshould handle AppError with custom error code in getModelDetails
[22m[39m[2025-08-31T12:39:27.287Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetModelDetails',
    message: 'Fetching model details',
    modelId: 'some-model'
  }
}
[2025-08-31T12:39:27.287Z] ERROR   - 
  Details: {
  metadata: {
    context: 'GetModelDetails',
    message: 'Failed to get model details with AppError',
    error: {
      name: 'AppError',
      message: 'Embedding service error',
      stack: 'AppError: Embedding service error\n' +
        '    at /C:/node/vector-db/tests/unit/routes/embeddings/models.test.ts:261:9\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)\n' +
        '    at C:/node/vector-db/node_modules/vitest/dist/chunks/runBaseTests.3qpJUEJM.js:126:11\n' +
        '    at withEnv (C:/node/vector-db/node_modules/vitest/dist/chunks/runBaseTests.3qpJUEJM.js:90:5)'
    },
    code: 'EMBEDDING_ERROR',
    statusCode: 500,
    modelId: 'some-model'
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/models.test.ts[2m > [22m[2mList Models Route[2m > [22m[2mGET /embeddings/models/{modelId}[2m > [22m[2mshould handle different model performance characteristics
[22m[39m[2025-08-31T12:39:27.289Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetModelDetails',
    message: 'Fetching model details',
    modelId: 'text-embedding-3-large'
  }
}
[2025-08-31T12:39:27.289Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetModelDetails',
    message: 'Successfully fetched model details',
    modelId: 'text-embedding-3-large'
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/models.test.ts[2m > [22m[2mList Models Route[2m > [22m[2mGET /embeddings/models/{modelId}[2m > [22m[2mshould handle non-Error exceptions in model details
[22m[39m[2025-08-31T12:39:27.290Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetModelDetails',
    message: 'Fetching model details',
    modelId: '@cf/baai/bge-base-en-v1.5'
  }
}
[2025-08-31T12:39:27.290Z] ERROR   - 
  Details: {
  metadata: {
    context: 'GetModelDetails',
    message: 'Unexpected error fetching model details',
    error: 'Unknown error string',
    modelId: '@cf/baai/bge-base-en-v1.5'
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/models.test.ts[2m > [22m[2mList Models Route[2m > [22m[2mGET /embeddings/models/{modelId}[2m > [22m[2mshould return default description for unknown models
[22m[39m[2025-08-31T12:39:27.291Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetModelDetails',
    message: 'Fetching model details',
    modelId: 'custom-model'
  }
}
[2025-08-31T12:39:27.291Z] INFO   - 
  Details: {
  metadata: {
    context: 'GetModelDetails',
    message: 'Successfully fetched model details',
    modelId: 'custom-model'
  }
}

 [32m✓[39m tests/unit/routes/embeddings/models.test.ts [2m([22m[2m14 tests[22m[2m)[22m[90m 23[2mms[22m[39m
 [32m✓[39m tests/unit/utils/response-builder-compat.test.ts [2m([22m[2m43 tests[22m[2m)[22m[90m 13[2mms[22m[39m
 [32m✓[39m tests/unit/routes/embeddings/embedding-service.test.ts [2m([22m[2m27 tests[22m[2m)[22m[90m 29[2mms[22m[39m
 [32m✓[39m tests/unit/utils/error-handler.test.ts [2m([22m[2m41 tests[22m[2m)[22m[90m 35[2mms[22m[39m
 [32m✓[39m tests/unit/base/durable-object.test.ts [2m([22m[2m34 tests[22m[2m)[22m[90m 35[2mms[22m[39m
[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mrecordError[2m > [22m[2mshould record error information
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'UNKNOWN_ERROR',
  message: 'Test error',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.676Z',
  retryCount: 1,
  recoverable: false
}

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mrecordError[2m > [22m[2mshould record AppError with correct error code
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout error',
  stepName: 'timeout-step',
  timestamp: '2025-08-31T12:39:27.677Z',
  retryCount: 2,
  recoverable: true
}

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mrecordError[2m > [22m[2mshould record error with default retry count
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'UNKNOWN_ERROR',
  message: 'Test error',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.678Z',
  retryCount: 0,
  recoverable: false
}

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mcanRetry[2m > [22m[2mshould allow retry for recoverable error under max retries
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.683Z',
  retryCount: 1,
  recoverable: true
}

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mcanRetry[2m > [22m[2mshould not allow retry for non-recoverable error
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'VALIDATION_ERROR',
  message: 'Invalid',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.684Z',
  retryCount: 1,
  recoverable: false
}

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mcanRetry[2m > [22m[2mshould not allow retry when max retries exceeded
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.685Z',
  retryCount: 3,
  recoverable: true
}

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mgetNextRetryCount[2m > [22m[2mshould return incremented retry count
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'UNKNOWN_ERROR',
  message: 'Test error',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.687Z',
  retryCount: 1,
  recoverable: false
}
[ErrorRecovery] Error recorded: {
  type: 'UNKNOWN_ERROR',
  message: 'Test error',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.687Z',
  retryCount: 2,
  recoverable: false
}

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithRetry[2m > [22m[2mshould execute operation successfully on first attempt
[22m[39m[ErrorRecovery] Executing step: test-step (attempt 1)

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithRetry[2m > [22m[2mshould retry on recoverable error and succeed
[22m[39m[ErrorRecovery] Executing step: test-step (attempt 1)
[ErrorRecovery] Executing step: test-step (attempt 2)
[ErrorRecovery] Waiting 1000ms before retry
[ErrorRecovery] Step test-step succeeded after 2 attempts

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithRetry[2m > [22m[2mshould retry on recoverable error and succeed
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.690Z',
  retryCount: 1,
  recoverable: true
}
[ErrorRecovery] Step test-step failed, will retry (1/3)

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithRetry[2m > [22m[2mshould fail after max retries exceeded
[22m[39m[ErrorRecovery] Executing step: test-step (attempt 1)
[ErrorRecovery] Executing step: test-step (attempt 2)
[ErrorRecovery] Waiting 1000ms before retry
[ErrorRecovery] Executing step: test-step (attempt 3)
[ErrorRecovery] Waiting 2000ms before retry

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithRetry[2m > [22m[2mshould fail after max retries exceeded
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.691Z',
  retryCount: 1,
  recoverable: true
}
[ErrorRecovery] Step test-step failed, will retry (1/3)
[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.691Z',
  retryCount: 2,
  recoverable: true
}
[ErrorRecovery] Step test-step failed, will retry (2/3)
[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.691Z',
  retryCount: 3,
  recoverable: true
}
[ErrorRecovery] Max retries exceeded for step: test-step

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithRetry[2m > [22m[2mshould not retry on non-recoverable error
[22m[39m[ErrorRecovery] Executing step: test-step (attempt 1)

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithRetry[2m > [22m[2mshould not retry on non-recoverable error
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'VALIDATION_ERROR',
  message: 'Invalid',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.692Z',
  retryCount: 1,
  recoverable: false
}
[ErrorRecovery] Max retries exceeded for step: test-step

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithFallback[2m > [22m[2mshould execute primary operation successfully
[22m[39m[ErrorRecovery] Executing step: test-step (attempt 1)

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithFallback[2m > [22m[2mshould execute fallback on primary failure
[22m[39m[ErrorRecovery] Executing step: test-step (attempt 1)
[ErrorRecovery] Executing step: test-step (attempt 2)
[ErrorRecovery] Waiting 1000ms before retry
[ErrorRecovery] Executing step: test-step (attempt 3)
[ErrorRecovery] Waiting 2000ms before retry
[ErrorRecovery] Primary operation failed for test-step, trying fallback
[ErrorRecovery] Fallback succeeded for step: test-step

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithFallback[2m > [22m[2mshould execute fallback on primary failure
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.694Z',
  retryCount: 1,
  recoverable: true
}
[ErrorRecovery] Step test-step failed, will retry (1/3)
[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.694Z',
  retryCount: 2,
  recoverable: true
}
[ErrorRecovery] Step test-step failed, will retry (2/3)
[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.695Z',
  retryCount: 3,
  recoverable: true
}
[ErrorRecovery] Max retries exceeded for step: test-step

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithFallback[2m > [22m[2mshould throw primary error when fallback also fails
[22m[39m[ErrorRecovery] Executing step: test-step (attempt 1)
[ErrorRecovery] Executing step: test-step (attempt 2)
[ErrorRecovery] Waiting 1000ms before retry
[ErrorRecovery] Executing step: test-step (attempt 3)
[ErrorRecovery] Waiting 2000ms before retry
[ErrorRecovery] Primary operation failed for test-step, trying fallback

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithFallback[2m > [22m[2mshould throw primary error when fallback also fails
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Primary timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.696Z',
  retryCount: 1,
  recoverable: true
}
[ErrorRecovery] Step test-step failed, will retry (1/3)
[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Primary timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.696Z',
  retryCount: 2,
  recoverable: true
}
[ErrorRecovery] Step test-step failed, will retry (2/3)
[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Primary timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.696Z',
  retryCount: 3,
  recoverable: true
}
[ErrorRecovery] Max retries exceeded for step: test-step
[ErrorRecovery] Fallback also failed for step: test-step
[ErrorRecovery] Error recorded: {
  type: 'UNKNOWN_ERROR',
  message: 'Fallback failed',
  stepName: 'test-step_fallback',
  timestamp: '2025-08-31T12:39:27.696Z',
  retryCount: 0,
  recoverable: false
}

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithFallback[2m > [22m[2mshould skip on error when skipOnError is true
[22m[39m[ErrorRecovery] Executing step: test-step (attempt 1)
[ErrorRecovery] Executing step: test-step (attempt 2)
[ErrorRecovery] Waiting 1000ms before retry
[ErrorRecovery] Executing step: test-step (attempt 3)
[ErrorRecovery] Waiting 2000ms before retry

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mexecuteWithFallback[2m > [22m[2mshould skip on error when skipOnError is true
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.697Z',
  retryCount: 1,
  recoverable: true
}
[ErrorRecovery] Step test-step failed, will retry (1/3)
[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.697Z',
  retryCount: 2,
  recoverable: true
}
[ErrorRecovery] Step test-step failed, will retry (2/3)
[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.697Z',
  retryCount: 3,
  recoverable: true
}
[ErrorRecovery] Max retries exceeded for step: test-step
[ErrorRecovery] Skipping failed step: test-step

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mhandlePartialSuccess[2m > [22m[2mshould handle mixed success and failure results
[22m[39m[ErrorRecovery] Partial success for batch-step: 2/3 (67%)

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mhandlePartialSuccess[2m > [22m[2mshould handle mixed success and failure results
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'UNKNOWN_ERROR',
  message: 'Error2',
  stepName: 'batch-step_item_1',
  timestamp: '2025-08-31T12:39:27.698Z',
  retryCount: 0,
  recoverable: false
}

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mhandlePartialSuccess[2m > [22m[2mshould handle all successful results
[22m[39m[ErrorRecovery] Partial success for batch-step: 2/2 (100%)

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mhandlePartialSuccess[2m > [22m[2mshould handle all failed results
[22m[39m[ErrorRecovery] Partial success for batch-step: 0/2 (0%)

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mhandlePartialSuccess[2m > [22m[2mshould handle all failed results
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'UNKNOWN_ERROR',
  message: 'Error1',
  stepName: 'batch-step_item_0',
  timestamp: '2025-08-31T12:39:27.700Z',
  retryCount: 0,
  recoverable: false
}
[ErrorRecovery] Error recorded: {
  type: 'UNKNOWN_ERROR',
  message: 'Error2',
  stepName: 'batch-step_item_1',
  timestamp: '2025-08-31T12:39:27.700Z',
  retryCount: 0,
  recoverable: false
}

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mgetErrorSummary[2m > [22m[2mshould generate error summary
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout1',
  stepName: 'step1',
  timestamp: '2025-08-31T12:39:27.701Z',
  retryCount: 1,
  recoverable: true
}
[ErrorRecovery] Error recorded: {
  type: 'VALIDATION_ERROR',
  message: 'Invalid',
  stepName: 'step2',
  timestamp: '2025-08-31T12:39:27.701Z',
  retryCount: 1,
  recoverable: false
}
[ErrorRecovery] Error recorded: {
  type: 'TIMEOUT',
  message: 'Timeout2',
  stepName: 'step1',
  timestamp: '2025-08-31T12:39:27.701Z',
  retryCount: 2,
  recoverable: true
}

[90mstderr[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mclearErrors[2m > [22m[2mshould clear all recorded errors
[22m[39m[ErrorRecovery] Error recorded: {
  type: 'UNKNOWN_ERROR',
  message: 'Test error',
  stepName: 'test-step',
  timestamp: '2025-08-31T12:39:27.702Z',
  retryCount: 1,
  recoverable: false
}

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mupdateStrategy[2m > [22m[2mshould update recovery strategy
[22m[39m[ErrorRecovery] Strategy updated: {
  maxRetries: 5,
  retryDelayMs: 2000,
  fallbackEnabled: true,
  skipOnError: false
}

[90mstdout[2m | tests/unit/workflows/error-recovery.test.ts[2m > [22m[2mErrorRecoveryManager[2m > [22m[2mupdateStrategy[2m > [22m[2mshould partially update strategy
[22m[39m[ErrorRecovery] Strategy updated: {
  maxRetries: 5,
  retryDelayMs: 1000,
  fallbackEnabled: true,
  skipOnError: false
}

 [32m✓[39m tests/unit/workflows/error-recovery.test.ts [2m([22m[2m31 tests[22m[2m)[22m[90m 4[2mms[22m[39m
 [32m✓[39m tests/unit/workflows.batch-embeddings.test.ts [2m([22m[2m18 tests[22m[2m)[22m[90m 19[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/notion/bulk-sync.test.ts[2m > [22m[2mBulk Sync Notion Pages Route[2m > [22m[2mPOST /notion/pages/bulk-sync[2m > [22m[2mshould handle NotionManager errors
[22m[39mBulk sync error: Error: NotionManager connection failed
    at /C:/node/vector-db/tests/unit/routes/notion/bulk-sync.test.ts:244:63
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/routes/notion/bulk-sync.test.ts[2m > [22m[2mBulk Sync Notion Pages Route[2m > [22m[2mPOST /notion/pages/bulk-sync[2m > [22m[2mshould handle non-Error exceptions
[22m[39mBulk sync error: String error

 [32m✓[39m tests/unit/routes/notion/bulk-sync.test.ts [2m([22m[2m11 tests[22m[2m)[22m[90m 5[2mms[22m[39m
 [32m✓[39m tests/unit/middleware/logging.test.ts [2m([22m[2m22 tests[22m[2m)[22m[90m 28[2mms[22m[39m
[90mstdout[2m | tests/unit/durable-objects/vector-statistics.test.ts[2m > [22m[2mVectorStatisticsManager[2m > [22m[2mresetStatistics[2m > [22m[2mshould reset statistics
[22m[39m{"timestamp":"2025-08-31T12:39:27.940Z","level":"INFO","method":"","path":"","metadata":{"context":"VectorStatistics","message":"Statistics reset"}}

[90mstdout[2m | tests/unit/durable-objects/vector-statistics.test.ts[2m > [22m[2mVectorStatisticsManager[2m > [22m[2mclearHistory[2m > [22m[2mshould clear search history
[22m[39m{"timestamp":"2025-08-31T12:39:27.940Z","level":"INFO","method":"","path":"","metadata":{"context":"VectorStatistics","message":"Search history cleared"}}

[90mstdout[2m | tests/unit/durable-objects/vector-statistics.test.ts[2m > [22m[2mVectorStatisticsManager[2m > [22m[2mstate management[2m > [22m[2mshould restore state correctly
[22m[39m{"timestamp":"2025-08-31T12:39:27.942Z","level":"INFO","method":"","path":"","metadata":{"context":"VectorStatistics","message":"State restored","historySize":1,"recentVectorsCount":1}}

 [32m✓[39m tests/unit/durable-objects/vector-statistics.test.ts [2m([22m[2m14 tests[22m[2m)[22m[90m 4[2mms[22m[39m
 [32m✓[39m tests/unit/workflows/vector-operations.test.ts [2m([22m[2m13 tests[22m[2m)[22m[90m 20[2mms[22m[39m
 [32m✓[39m tests/unit/durable-objects/notion-api-client.test.ts [2m([22m[2m26 tests[22m[2m)[22m[90m 32[2mms[22m[39m
 [32m✓[39m tests/unit/middleware/auth.test.ts [2m([22m[2m24 tests[22m[2m)[22m[90m 17[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/notion/retrieve-blocks.test.ts[2m > [22m[2mRetrieve Notion Blocks Route[2m > [22m[2mGET /notion/pages/{pageId}/blocks[2m > [22m[2mshould handle errors from NotionService
[22m[39mRetrieve blocks error: Error: Database connection error
    at /C:/node/vector-db/tests/unit/routes/notion/retrieve-blocks.test.ts:228:51
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/routes/notion/retrieve-blocks.test.ts[2m > [22m[2mRetrieve Notion Blocks Route[2m > [22m[2mGET /notion/pages/{pageId}/blocks[2m > [22m[2mshould handle non-Error exceptions
[22m[39mRetrieve blocks error: String error

 [32m✓[39m tests/unit/routes/notion/retrieve-blocks.test.ts [2m([22m[2m9 tests[22m[2m)[22m[90m 15[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/files/status.test.ts[2m > [22m[2mFile Status Route[2m > [22m[2mGET /files/status/{workflowId}[2m > [22m[2mshould handle other errors
[22m[39mFile status error: Error: Database error
    at /C:/node/vector-db/tests/unit/routes/files/status.test.ts:183:74
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/routes/files/status.test.ts[2m > [22m[2mFile Status Route[2m > [22m[2mGET /files/status/{workflowId}[2m > [22m[2mshould handle non-Error exceptions
[22m[39mFile status error: String error

 [32m✓[39m tests/unit/routes/files/status.test.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 7[2mms[22m[39m
[90mstdout[2m | tests/unit/routes/vectors/bulk-delete.test.ts[2m > [22m[2mBulk Delete Vectors Route[2m > [22m[2mPOST /vectors/bulk-delete[2m > [22m[2mshould delete vectors successfully
[22m[39m[bulk-delete] Deleting 3 vectors
[bulk-delete] Batch 1: Delete operation enqueued for 3 vectors

[90mstdout[2m | tests/unit/routes/vectors/bulk-delete.test.ts[2m > [22m[2mBulk Delete Vectors Route[2m > [22m[2mPOST /vectors/bulk-delete[2m > [22m[2mshould handle deletion errors
[22m[39m[bulk-delete] Deleting 150 vectors
[bulk-delete] Batch 2: Delete operation enqueued for 50 vectors

[90mstderr[2m | tests/unit/routes/vectors/bulk-delete.test.ts[2m > [22m[2mBulk Delete Vectors Route[2m > [22m[2mPOST /vectors/bulk-delete[2m > [22m[2mshould handle deletion errors
[22m[39m[bulk-delete] Batch 1 failed: Error: Delete failed
    at /C:/node/vector-db/tests/unit/routes/vectors/bulk-delete.test.ts:74:70
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstdout[2m | tests/unit/routes/vectors/bulk-delete.test.ts[2m > [22m[2mBulk Delete Vectors Route[2m > [22m[2mPOST /vectors/bulk-delete[2m > [22m[2mshould handle non-Error deletion failures
[22m[39m[bulk-delete] Deleting 150 vectors
[bulk-delete] Batch 2: Delete operation enqueued for 50 vectors

[90mstderr[2m | tests/unit/routes/vectors/bulk-delete.test.ts[2m > [22m[2mBulk Delete Vectors Route[2m > [22m[2mPOST /vectors/bulk-delete[2m > [22m[2mshould handle non-Error deletion failures
[22m[39m[bulk-delete] Batch 1 failed: String error

[90mstdout[2m | tests/unit/routes/vectors/bulk-delete.test.ts[2m > [22m[2mBulk Delete Vectors Route[2m > [22m[2mPOST /vectors/bulk-delete[2m > [22m[2mshould handle VectorManager update failure gracefully
[22m[39m[bulk-delete] Deleting 1 vectors
[bulk-delete] Batch 1: Delete operation enqueued for 1 vectors

[90mstderr[2m | tests/unit/routes/vectors/bulk-delete.test.ts[2m > [22m[2mBulk Delete Vectors Route[2m > [22m[2mPOST /vectors/bulk-delete[2m > [22m[2mshould handle VectorManager update failure gracefully
[22m[39m[bulk-delete] Failed to update VectorManager state: Error: Update failed
    at /C:/node/vector-db/tests/unit/routes/vectors/bulk-delete.test.ts:113:74
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstdout[2m | tests/unit/routes/vectors/bulk-delete.test.ts[2m > [22m[2mBulk Delete Vectors Route[2m > [22m[2mPOST /vectors/bulk-delete[2m > [22m[2mshould process batches correctly
[22m[39m[bulk-delete] Deleting 250 vectors
[bulk-delete] Batch 1: Delete operation enqueued for 100 vectors
[bulk-delete] Batch 2: Delete operation enqueued for 100 vectors
[bulk-delete] Batch 3: Delete operation enqueued for 50 vectors

[90mstderr[2m | tests/unit/routes/vectors/bulk-delete.test.ts[2m > [22m[2mBulk Delete Vectors Route[2m > [22m[2mHandler direct tests for edge cases[2m > [22m[2mshould handle general errors in the main try-catch
[22m[39mBulk delete vectors error: Error: Unexpected error
    at /C:/node/vector-db/tests/unit/routes/vectors/bulk-delete.test.ts:220:65
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/routes/vectors/bulk-delete.test.ts[2m > [22m[2mBulk Delete Vectors Route[2m > [22m[2mHandler direct tests for edge cases[2m > [22m[2mshould handle non-Error objects in the main catch
[22m[39mBulk delete vectors error: String error

 [32m✓[39m tests/unit/routes/vectors/bulk-delete.test.ts [2m([22m[2m13 tests[22m[2m)[22m[90m 3[2mms[22m[39m
 [32m✓[39m tests/unit/middleware/error.test.ts [2m([22m[2m14 tests[22m[2m)[22m[90m 17[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/notion/retrieve-page.test.ts[2m > [22m[2mRetrieve Notion Page Route[2m > [22m[2mGET /notion/pages/{pageId}[2m > [22m[2mshould handle errors from NotionOrchestrator
[22m[39mError: {
  timestamp: '2025-08-31T12:39:28.572Z',
  path: '/notion/pages/page-error',
  method: 'GET',
  query: {},
  error: {
    name: 'Error',
    message: 'Database connection error',
    stack: 'Error: Database connection error\n' +
      '    at /C:/node/vector-db/tests/unit/routes/notion/retrieve-page.test.ts:124:37\n' +
      '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
      '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
      '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
      '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
      '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
  }
}

[90mstderr[2m | tests/unit/routes/notion/retrieve-page.test.ts[2m > [22m[2mRetrieve Notion Page Route[2m > [22m[2mGET /notion/pages/{pageId}[2m > [22m[2mshould handle non-Error exceptions
[22m[39mError: {
  timestamp: '2025-08-31T12:39:28.573Z',
  path: '/notion/pages/page-error',
  method: 'GET',
  query: {},
  error: 'String error'
}

 [32m✓[39m tests/unit/routes/notion/retrieve-page.test.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 13[2mms[22m[39m
 [32m✓[39m tests/unit/routes/index.test.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 12[2mms[22m[39m
[90mstdout[2m | tests/unit/routes/search/vectors.test.ts[2m > [22m[2mSearch Vectors Route[2m > [22m[2mPOST /search[2m > [22m[2mshould search vectors successfully
[22m[39m[2025-08-31T12:39:28.795Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Starting vector search',
    query: 'test search query',
    topK: 5,
    namespace: undefined
  }
}
[2025-08-31T12:39:28.795Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Search completed',
    resultCount: 2,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/vectors.test.ts[2m > [22m[2mSearch Vectors Route[2m > [22m[2mPOST /search[2m > [22m[2mshould handle search with namespace and filter
[22m[39m[2025-08-31T12:39:28.797Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Starting vector search',
    query: 'filtered search',
    topK: 10,
    namespace: 'test-namespace'
  }
}
[2025-08-31T12:39:28.798Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Search completed',
    resultCount: 1,
    processingTime: 1
  }
}

[90mstdout[2m | tests/unit/routes/search/vectors.test.ts[2m > [22m[2mSearch Vectors Route[2m > [22m[2mPOST /search[2m > [22m[2mshould use default topK when not provided
[22m[39m[2025-08-31T12:39:28.799Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Starting vector search',
    query: 'minimal search',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T12:39:28.800Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Search completed',
    resultCount: 0,
    processingTime: 1
  }
}

[90mstdout[2m | tests/unit/routes/search/vectors.test.ts[2m > [22m[2mSearch Vectors Route[2m > [22m[2mPOST /search[2m > [22m[2mshould handle AI embedding generation failure
[22m[39m[2025-08-31T12:39:28.808Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Starting vector search',
    query: 'test query',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T12:39:28.809Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Search failed',
    error: {
      name: 'AppError',
      message: 'Failed to generate embedding for query',
      stack: 'AppError: Failed to generate embedding for query\n' +
        '    at SearchService.embedText (/C:/node/vector-db/src/routes/api/search/search-service.ts:1075:15)\n' +
        '    at SearchService.searchByText (/C:/node/vector-db/src/routes/api/search/search-service.ts:1113:49)\n' +
        '    at searchVectorsHandler (/C:/node/vector-db/src/routes/api/search/vectors.ts:362:46)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/vectors.test.ts:161:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5'
    },
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/vectors.test.ts[2m > [22m[2mSearch Vectors Route[2m > [22m[2mPOST /search[2m > [22m[2mshould handle AI run without data property
[22m[39m[2025-08-31T12:39:28.811Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Starting vector search',
    query: 'test query',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T12:39:28.811Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Search failed',
    error: {
      name: 'AppError',
      message: 'Failed to generate embedding for query',
      stack: 'AppError: Failed to generate embedding for query\n' +
        '    at SearchService.embedText (/C:/node/vector-db/src/routes/api/search/search-service.ts:1075:15)\n' +
        '    at SearchService.searchByText (/C:/node/vector-db/src/routes/api/search/search-service.ts:1113:49)\n' +
        '    at searchVectorsHandler (/C:/node/vector-db/src/routes/api/search/vectors.ts:362:46)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/vectors.test.ts:181:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5'
    },
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/vectors.test.ts[2m > [22m[2mSearch Vectors Route[2m > [22m[2mPOST /search[2m > [22m[2mshould handle vectorize query errors
[22m[39m[2025-08-31T12:39:28.813Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Starting vector search',
    query: 'error test',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T12:39:28.813Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Search failed',
    error: {
      name: 'AppError',
      message: '検索中にエラーが発生しました',
      stack: 'AppError: 検索中にエラーが発生しました\n' +
        '    at SearchService.searchByVector (/C:/node/vector-db/src/routes/api/search/search-service.ts:1105:13)\n' +
        '    at SearchService.searchByText (/C:/node/vector-db/src/routes/api/search/search-service.ts:1114:53)\n' +
        '    at searchVectorsHandler (/C:/node/vector-db/src/routes/api/search/vectors.ts:362:46)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/vectors.test.ts:198:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5'
    },
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/vectors.test.ts[2m > [22m[2mSearch Vectors Route[2m > [22m[2mPOST /search[2m > [22m[2mshould handle non-Error exceptions
[22m[39m[2025-08-31T12:39:28.815Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Starting vector search',
    query: 'non-error test',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T12:39:28.815Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Search failed',
    error: {
      name: 'AppError',
      message: '検索中にエラーが発生しました',
      stack: 'AppError: 検索中にエラーが発生しました\n' +
        '    at SearchService.searchByVector (/C:/node/vector-db/src/routes/api/search/search-service.ts:1105:13)\n' +
        '    at SearchService.searchByText (/C:/node/vector-db/src/routes/api/search/search-service.ts:1114:53)\n' +
        '    at searchVectorsHandler (/C:/node/vector-db/src/routes/api/search/vectors.ts:362:46)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/vectors.test.ts:218:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5'
    },
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/vectors.test.ts[2m > [22m[2mSearch Vectors Route[2m > [22m[2mPOST /search[2m > [22m[2mshould include values when requested
[22m[39m[2025-08-31T12:39:28.817Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Starting vector search',
    query: 'include values test',
    topK: 10,
    namespace: undefined
  }
}
[2025-08-31T12:39:28.817Z] INFO   - 
  Details: {
  metadata: {
    context: 'SearchVectors',
    message: 'Search completed',
    resultCount: 1,
    processingTime: 0
  }
}

 [32m✓[39m tests/unit/routes/search/vectors.test.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 3[2mms[22m[39m
 [32m✓[39m tests/unit/utils/retry.test.ts [2m([22m[2m20 tests[22m[2m)[22m[90m 77[2mms[22m[39m
[90mstdout[2m | tests/unit/routes/search/similar.test.ts[2m > [22m[2mSimilar Search Route[2m > [22m[2mPOST /search/similar[2m > [22m[2mshould find similar vectors successfully
[22m[39m[2025-08-31T12:39:29.048Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Starting similar search',
    vectorId: 'vec_123456',
    topK: 5,
    namespace: undefined,
    excludeSelf: true
  }
}
[2025-08-31T12:39:29.048Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Similar search completed',
    vectorId: 'vec_123456',
    resultCount: 2,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/similar.test.ts[2m > [22m[2mSimilar Search Route[2m > [22m[2mPOST /search/similar[2m > [22m[2mshould handle namespace and excludeSelf parameters
[22m[39m[2025-08-31T12:39:29.050Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Starting similar search',
    vectorId: 'vec_test',
    topK: 10,
    namespace: 'test-namespace',
    excludeSelf: false
  }
}
[2025-08-31T12:39:29.051Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Similar search completed',
    vectorId: 'vec_test',
    resultCount: 1,
    processingTime: 1
  }
}

[90mstdout[2m | tests/unit/routes/search/similar.test.ts[2m > [22m[2mSimilar Search Route[2m > [22m[2mPOST /search/similar[2m > [22m[2mshould use default values when optional parameters are not provided
[22m[39m[2025-08-31T12:39:29.052Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Starting similar search',
    vectorId: 'vec_minimal',
    topK: 10,
    namespace: undefined,
    excludeSelf: true
  }
}
[2025-08-31T12:39:29.052Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Similar search completed',
    vectorId: 'vec_minimal',
    resultCount: 0,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/similar.test.ts[2m > [22m[2mSimilar Search Route[2m > [22m[2mPOST /search/similar[2m > [22m[2mshould handle vector not found error
[22m[39m[2025-08-31T12:39:29.063Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Starting similar search',
    vectorId: 'vec_nonexistent',
    topK: 10,
    namespace: undefined,
    excludeSelf: true
  }
}
[2025-08-31T12:39:29.063Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Similar search failed',
    error: {
      name: 'AppError',
      message: 'Vector not found: vec_nonexistent',
      stack: 'AppError: Vector not found: vec_nonexistent\n' +
        '    at SearchService.searchSimilar (/C:/node/vector-db/src/routes/api/search/search-service.ts:1143:15)\n' +
        '    at similarSearchHandler (/C:/node/vector-db/src/routes/api/search/similar.ts:363:46)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/similar.test.ts:161:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)'
    },
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/similar.test.ts[2m > [22m[2mSimilar Search Route[2m > [22m[2mPOST /search/similar[2m > [22m[2mshould handle other errors
[22m[39m[2025-08-31T12:39:29.065Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Starting similar search',
    vectorId: 'vec_error',
    topK: 10,
    namespace: undefined,
    excludeSelf: true
  }
}
[2025-08-31T12:39:29.066Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Similar search failed',
    error: {
      name: 'AppError',
      message: '類似検索中にエラーが発生しました',
      stack: 'AppError: 類似検索中にエラーが発生しました\n' +
        '    at SearchService.searchSimilar (/C:/node/vector-db/src/routes/api/search/search-service.ts:1148:13)\n' +
        '    at similarSearchHandler (/C:/node/vector-db/src/routes/api/search/similar.ts:363:46)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/similar.test.ts:177:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)'
    },
    processingTime: 1
  }
}

[90mstdout[2m | tests/unit/routes/search/similar.test.ts[2m > [22m[2mSimilar Search Route[2m > [22m[2mPOST /search/similar[2m > [22m[2mshould handle non-Error exceptions
[22m[39m[2025-08-31T12:39:29.067Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Starting similar search',
    vectorId: 'vec_unknown',
    topK: 10,
    namespace: undefined,
    excludeSelf: true
  }
}
[2025-08-31T12:39:29.068Z] ERROR   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Similar search failed',
    error: {
      name: 'AppError',
      message: '類似検索中にエラーが発生しました',
      stack: 'AppError: 類似検索中にエラーが発生しました\n' +
        '    at SearchService.searchSimilar (/C:/node/vector-db/src/routes/api/search/search-service.ts:1148:13)\n' +
        '    at similarSearchHandler (/C:/node/vector-db/src/routes/api/search/similar.ts:363:46)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
        '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/search/similar.test.ts:193:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)'
    },
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/similar.test.ts[2m > [22m[2mSimilar Search Route[2m > [22m[2mPOST /search/similar[2m > [22m[2mshould handle empty search results
[22m[39m[2025-08-31T12:39:29.069Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Starting similar search',
    vectorId: 'vec_no_similar',
    topK: 10,
    namespace: undefined,
    excludeSelf: true
  }
}
[2025-08-31T12:39:29.069Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Similar search completed',
    vectorId: 'vec_no_similar',
    resultCount: 0,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/search/similar.test.ts[2m > [22m[2mSimilar Search Route[2m > [22m[2mPOST /search/similar[2m > [22m[2mshould handle special characters in vectorId
[22m[39m[2025-08-31T12:39:29.071Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Starting similar search',
    vectorId: 'vec_special-chars_123',
    topK: 10,
    namespace: undefined,
    excludeSelf: true
  }
}
[2025-08-31T12:39:29.071Z] INFO   - 
  Details: {
  metadata: {
    context: 'SimilarSearch',
    message: 'Similar search completed',
    vectorId: 'vec_special-chars_123',
    resultCount: 1,
    processingTime: 0
  }
}

 [32m✓[39m tests/unit/routes/search/similar.test.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 3[2mms[22m[39m
 [32m✓[39m tests/unit/services.test.ts [2m([22m[2m15 tests[22m[2m)[22m[90m 6[2mms[22m[39m
 [32m✓[39m tests/unit/workflows/notion-sync-multiselect.test.ts [2m([22m[2m4 tests[22m[2m)[22m[90m 11[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/vectors/delete.test.ts[2m > [22m[2mDelete Vector Route[2m > [22m[2mDELETE /vectors/{id}[2m > [22m[2mshould handle VectorManager errors
[22m[39mDelete vector error: Error: VectorManager error
    at /C:/node/vector-db/tests/unit/routes/vectors/delete.test.ts:59:9
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)
Error: {
  timestamp: '2025-08-31T12:39:29.291Z',
  path: '/vectors/test-id',
  method: 'DELETE',
  query: {},
  error: {
    name: 'Error',
    message: 'VectorManager error',
    stack: 'Error: VectorManager error\n' +
      '    at /C:/node/vector-db/tests/unit/routes/vectors/delete.test.ts:59:9\n' +
      '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
      '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
      '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
      '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
      '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
  }
}

[90mstderr[2m | tests/unit/routes/vectors/delete.test.ts[2m > [22m[2mDelete Vector Route[2m > [22m[2mDELETE /vectors/{id}[2m > [22m[2mshould handle non-Error exceptions
[22m[39mDelete vector error: String error
Error: {
  timestamp: '2025-08-31T12:39:29.293Z',
  path: '/vectors/test-id',
  method: 'DELETE',
  query: {},
  error: 'String error'
}

 [32m✓[39m tests/unit/routes/vectors/delete.test.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 7[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/vectors/delete-all.test.ts[2m > [22m[2mDelete All Vectors Route[2m > [22m[2mDELETE /vectors/all[2m > [22m[2mshould handle VectorManager errors
[22m[39mDelete all vectors error: Error: VectorManager error
    at /C:/node/vector-db/tests/unit/routes/vectors/delete-all.test.ts:91:70
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/routes/vectors/delete-all.test.ts[2m > [22m[2mDelete All Vectors Route[2m > [22m[2mDELETE /vectors/all[2m > [22m[2mshould handle non-Error exceptions
[22m[39mDelete all vectors error: { code: 'UNKNOWN_ERROR' }

 [32m✓[39m tests/unit/routes/vectors/delete-all.test.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 16[2mms[22m[39m
 [32m✓[39m tests/unit/workflows/batch-embeddings.test.ts [2m([22m[2m13 tests[22m[2m)[22m[90m 19[2mms[22m[39m
 [32m✓[39m tests/unit/durable-objects/ai-embeddings.test.ts [2m([22m[2m11 tests[22m[2m)[22m[90m 8[2mms[22m[39m
[90mstderr[2m | tests/unit/services/notion-orchestrator.test.ts[2m > [22m[2mNotionOrchestrator[2m > [22m[2msyncAllPages[2m > [22m[2mshould handle sync errors gracefully
[22m[39mFailed to sync page page-2: Error: Sync failed
    at /C:/node/vector-db/tests/unit/services/notion-orchestrator.test.ts:106:93
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

 [32m✓[39m tests/unit/services/notion-orchestrator.test.ts [2m([22m[2m13 tests[22m[2m)[22m[90m 10[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/vectors/list.test.ts[2m > [22m[2mList Vectors Route[2m > [22m[2mGET /vectors[2m > [22m[2mshould handle Durable Object errors
[22m[39mList vectors error: Error: List vectors failed
    at /C:/node/vector-db/tests/unit/routes/vectors/list.test.ts:171:55
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/routes/vectors/list.test.ts[2m > [22m[2mList Vectors Route[2m > [22m[2mGET /vectors[2m > [22m[2mshould handle non-Error exceptions
[22m[39mList vectors error: String error

 [32m✓[39m tests/unit/routes/vectors/list.test.ts [2m([22m[2m11 tests[22m[2m)[22m[90m 18[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/vectors/status.test.ts[2m > [22m[2mVector Job Status Routes[2m > [22m[2mGET /vectors/jobs/{jobId}[2m > [22m[2mshould handle errors gracefully
[22m[39mGet job status error: Error: Database error
    at /C:/node/vector-db/tests/unit/routes/vectors/status.test.ts:57:70
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)
Get job status error: Error: Database error
    at /C:/node/vector-db/tests/unit/routes/vectors/status.test.ts:57:70
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/routes/vectors/status.test.ts[2m > [22m[2mVector Job Status Routes[2m > [22m[2mGET /vectors/jobs/{jobId}[2m > [22m[2mshould handle invalid job data gracefully
[22m[39mGet job status error: ZodError: [
  {
    "code": "invalid_value",
    "values": [
      "create",
      "delete"
    ],
    "path": [
      "type"
    ],
    "message": "Invalid option: expected one of \"create\"|\"delete\""
  },
  {
    "code": "invalid_value",
    "values": [
      "pending",
      "processing",
      "completed",
      "failed"
    ],
    "path": [
      "status"
    ],
    "message": "Invalid option: expected one of \"pending\"|\"processing\"|\"completed\"|\"failed\""
  },
  {
    "expected": "string",
    "code": "invalid_type",
    "path": [
      "createdAt"
    ],
    "message": "Invalid input: expected string, received undefined"
  }
]
    at VectorJobService.getJobStatus (/C:/node/vector-db/src/routes/api/vectors/job-service.ts:973:91)
    at getJobStatusHandler (/C:/node/vector-db/src/routes/api/vectors/status.ts:648:45)
    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)
    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5
    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)
    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25
    at /C:/node/vector-db/tests/unit/routes/vectors/status.test.ts:77:24
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
Get job status error: ZodError: [
  {
    "code": "invalid_value",
    "values": [
      "create",
      "delete"
    ],
    "path": [
      "type"
    ],
    "message": "Invalid option: expected one of \"create\"|\"delete\""
  },
  {
    "code": "invalid_value",
    "values": [
      "pending",
      "processing",
      "completed",
      "failed"
    ],
    "path": [
      "status"
    ],
    "message": "Invalid option: expected one of \"pending\"|\"processing\"|\"completed\"|\"failed\""
  },
  {
    "expected": "string",
    "code": "invalid_type",
    "path": [
      "createdAt"
    ],
    "message": "Invalid input: expected string, received undefined"
  }
]
    at VectorJobService.getJobStatus (/C:/node/vector-db/src/routes/api/vectors/job-service.ts:973:91)
    at getJobStatusHandler (/C:/node/vector-db/src/routes/api/vectors/status.ts:648:45)
    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)
    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5
    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)
    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25
    at /C:/node/vector-db/tests/unit/routes/vectors/status.test.ts:77:24
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)

[90mstderr[2m | tests/unit/routes/vectors/status.test.ts[2m > [22m[2mVector Job Status Routes[2m > [22m[2mGET /vectors/jobs[2m > [22m[2mshould handle errors gracefully
[22m[39mGet all jobs error: Error: Database connection failed
    at /C:/node/vector-db/tests/unit/routes/vectors/status.test.ts:143:68
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)
Get all jobs error: Error: Database connection failed
    at /C:/node/vector-db/tests/unit/routes/vectors/status.test.ts:143:68
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/routes/vectors/status.test.ts[2m > [22m[2mVector Job Status Routes[2m > [22m[2mGET /vectors/jobs[2m > [22m[2mshould handle non-Error exceptions in getJobStatus
[22m[39mGet job status error: String error
Get job status error: String error

[90mstderr[2m | tests/unit/routes/vectors/status.test.ts[2m > [22m[2mVector Job Status Routes[2m > [22m[2mGET /vectors/jobs[2m > [22m[2mshould handle non-Error exceptions in getAllJobs
[22m[39mGet all jobs error: String error
Get all jobs error: String error

[90mstderr[2m | tests/unit/routes/vectors/status.test.ts[2m > [22m[2mVector Job Status Routes[2m > [22m[2mGET /vectors/jobs[2m > [22m[2mshould handle invalid jobs data gracefully
[22m[39mGet all jobs error: ZodError: [
  {
    "code": "invalid_value",
    "values": [
      "create",
      "delete"
    ],
    "path": [
      0,
      "type"
    ],
    "message": "Invalid option: expected one of \"create\"|\"delete\""
  },
  {
    "code": "invalid_value",
    "values": [
      "pending",
      "processing",
      "completed",
      "failed"
    ],
    "path": [
      0,
      "status"
    ],
    "message": "Invalid option: expected one of \"pending\"|\"processing\"|\"completed\"|\"failed\""
  },
  {
    "expected": "string",
    "code": "invalid_type",
    "path": [
      0,
      "createdAt"
    ],
    "message": "Invalid input: expected string, received undefined"
  }
]
    at VectorJobService.getAllJobs (/C:/node/vector-db/src/routes/api/vectors/job-service.ts:994:124)
    at getAllJobsHandler (/C:/node/vector-db/src/routes/api/vectors/status.ts:740:35)
    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)
    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5
    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)
    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25
    at /C:/node/vector-db/tests/unit/routes/vectors/status.test.ts:190:24
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
Get all jobs error: ZodError: [
  {
    "code": "invalid_value",
    "values": [
      "create",
      "delete"
    ],
    "path": [
      0,
      "type"
    ],
    "message": "Invalid option: expected one of \"create\"|\"delete\""
  },
  {
    "code": "invalid_value",
    "values": [
      "pending",
      "processing",
      "completed",
      "failed"
    ],
    "path": [
      0,
      "status"
    ],
    "message": "Invalid option: expected one of \"pending\"|\"processing\"|\"completed\"|\"failed\""
  },
  {
    "expected": "string",
    "code": "invalid_type",
    "path": [
      0,
      "createdAt"
    ],
    "message": "Invalid input: expected string, received undefined"
  }
]
    at VectorJobService.getAllJobs (/C:/node/vector-db/src/routes/api/vectors/job-service.ts:994:124)
    at getAllJobsHandler (/C:/node/vector-db/src/routes/api/vectors/status.ts:740:35)
    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)
    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5
    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)
    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25
    at /C:/node/vector-db/tests/unit/routes/vectors/status.test.ts:190:24
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)

 [32m✓[39m tests/unit/routes/vectors/status.test.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 9[2mms[22m[39m
[90mstdout[2m | tests/unit/routes/embeddings/batch.test.ts[2m > [22m[2mBatch Embeddings Route[2m > [22m[2mPOST /embeddings/batch[2m > [22m[2mshould generate batch embeddings successfully
[22m[39m[2025-08-31T12:39:29.904Z] INFO   - 
  Details: {
  metadata: {
    context: 'BatchEmbedding',
    message: 'Starting batch embedding generation',
    textsCount: 3,
    model: '@cf/baai/bge-base-en-v1.5',
    batchSize: 10,
    saveToVectorize: true
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/batch.test.ts[2m > [22m[2mBatch Embeddings Route[2m > [22m[2mPOST /embeddings/batch[2m > [22m[2mshould generate batch embeddings successfully
[22m[39m[2025-08-31T12:39:29.905Z] INFO   - 
  Details: {
  metadata: {
    context: 'BatchEmbedding',
    message: 'Batch embedding generation initiated',
    batchId: 'batch-123',
    workflowCount: 3,
    processingTime: 1
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/batch.test.ts[2m > [22m[2mBatch Embeddings Route[2m > [22m[2mPOST /embeddings/batch[2m > [22m[2mshould work with minimal parameters
[22m[39m[2025-08-31T12:39:29.909Z] INFO   - 
  Details: {
  metadata: {
    context: 'BatchEmbedding',
    message: 'Starting batch embedding generation',
    textsCount: 2,
    model: undefined,
    batchSize: 10,
    saveToVectorize: false
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/batch.test.ts[2m > [22m[2mBatch Embeddings Route[2m > [22m[2mPOST /embeddings/batch[2m > [22m[2mshould work with minimal parameters
[22m[39m[2025-08-31T12:39:29.910Z] INFO   - 
  Details: {
  metadata: {
    context: 'BatchEmbedding',
    message: 'Batch embedding generation initiated',
    batchId: 'batch-minimal',
    workflowCount: 2,
    processingTime: 1
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/batch.test.ts[2m > [22m[2mBatch Embeddings Route[2m > [22m[2mPOST /embeddings/batch[2m > [22m[2mshould return 400 for empty text string in array
[22m[39m[2025-08-31T12:39:29.916Z] ERROR   - 
  Details: {
  metadata: {
    context: 'BatchEmbedding',
    message: 'Batch embedding generation failed with AppError',
    error: {
      name: 'AppError',
      message: 'Text at index 1 cannot be empty',
      stack: 'AppError: Text at index 1 cannot be empty\n' +
        '    at batchEmbeddingHandler (/C:/node/vector-db/src/routes/api/embeddings/batch.ts:730:13)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:23)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/compose.js:22:46\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:11\n' +
        '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/embeddings/batch.test.ts:133:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)'
    },
    code: 'VALIDATION_ERROR',
    statusCode: 400,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/batch.test.ts[2m > [22m[2mBatch Embeddings Route[2m > [22m[2mPOST /embeddings/batch[2m > [22m[2mshould return 400 for whitespace-only text string
[22m[39m[2025-08-31T12:39:29.918Z] ERROR   - 
  Details: {
  metadata: {
    context: 'BatchEmbedding',
    message: 'Batch embedding generation failed with AppError',
    error: {
      name: 'AppError',
      message: 'Text at index 1 cannot be empty',
      stack: 'AppError: Text at index 1 cannot be empty\n' +
        '    at batchEmbeddingHandler (/C:/node/vector-db/src/routes/api/embeddings/batch.ts:730:13)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:23)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/compose.js:22:46\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:11\n' +
        '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
        '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
        '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
        '    at /C:/node/vector-db/tests/unit/routes/embeddings/batch.test.ts:147:24\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)'
    },
    code: 'VALIDATION_ERROR',
    statusCode: 400,
    processingTime: 0
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/batch.test.ts[2m > [22m[2mBatch Embeddings Route[2m > [22m[2mPOST /embeddings/batch[2m > [22m[2mshould handle Durable Object errors
[22m[39m[2025-08-31T12:39:29.920Z] INFO   - 
  Details: {
  metadata: {
    context: 'BatchEmbedding',
    message: 'Starting batch embedding generation',
    textsCount: 2,
    model: undefined,
    batchSize: 10,
    saveToVectorize: false
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/batch.test.ts[2m > [22m[2mBatch Embeddings Route[2m > [22m[2mPOST /embeddings/batch[2m > [22m[2mshould handle Durable Object errors
[22m[39m[2025-08-31T12:39:29.922Z] ERROR   - 
  Details: {
  metadata: {
    context: 'BatchEmbedding',
    message: 'Unexpected batch embedding generation error',
    error: {
      name: 'Error',
      message: 'Batch processing error',
      stack: 'Error: Batch processing error\n' +
        '    at /C:/node/vector-db/tests/unit/routes/embeddings/batch.test.ts:155:70\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    },
    processingTime: 2
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/batch.test.ts[2m > [22m[2mBatch Embeddings Route[2m > [22m[2mPOST /embeddings/batch[2m > [22m[2mshould handle non-Error exceptions
[22m[39m[2025-08-31T12:39:29.924Z] INFO   - 
  Details: {
  metadata: {
    context: 'BatchEmbedding',
    message: 'Starting batch embedding generation',
    textsCount: 1,
    model: undefined,
    batchSize: 10,
    saveToVectorize: false
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/batch.test.ts[2m > [22m[2mBatch Embeddings Route[2m > [22m[2mPOST /embeddings/batch[2m > [22m[2mshould handle non-Error exceptions
[22m[39m[2025-08-31T12:39:29.926Z] ERROR   - 
  Details: {
  metadata: {
    context: 'BatchEmbedding',
    message: 'Unexpected batch embedding generation error',
    error: 'String error',
    processingTime: 2
  }
}

 [32m✓[39m tests/unit/routes/embeddings/batch.test.ts [2m([22m[2m8 tests[22m[2m)[22m[90m 28[2mms[22m[39m
 [32m✓[39m tests/unit/workflows/embeddings.test.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 19[2mms[22m[39m
[90mstdout[2m | tests/unit/workflows/file-analyzer.test.ts[2m > [22m[2mFileAnalyzer[2m > [22m[2mrun[2m > [22m[2mshould analyze PDF file successfully
[22m[39m[2025-08-31T12:39:30.097Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow started',
    params: {
      fileName: 'test.pdf',
      fileType: 'application/pdf',
      fileSize: 1024,
      fileData: 'dGVzdCBwZGYgY29udGVudA==',
      namespace: 'test'
    },
    timestamp: '2025-08-31T12:39:30.097Z'
  }
}
[2025-08-31T12:39:30.098Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Starting file analysis',
    fileName: 'test.pdf',
    fileType: 'application/pdf',
    fileSize: 1024
  }
}
[2025-08-31T12:39:30.098Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step started: analyze-file' }
}
[2025-08-31T12:39:30.098Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Analyzing file with AI',
    model: 'gemma-7b-it',
    fileType: 'pdf'
  }
}
[2025-08-31T12:39:30.098Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step completed: analyze-file' }
}
[2025-08-31T12:39:30.098Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow completed',
    duration: 1,
    result: {
      description: 'AI analyzed pdf: test.pdf',
      extractedText: 'This is extracted text from the file',
      topics: 'This is extracted text from the file',
      keywords: 'This is extracted text from the file',
      hasText: true,
      metadata: [Object]
    }
  }
}

[90mstdout[2m | tests/unit/workflows/file-analyzer.test.ts[2m > [22m[2mFileAnalyzer[2m > [22m[2mrun[2m > [22m[2mshould analyze image file successfully
[22m[39m[2025-08-31T12:39:30.102Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow started',
    params: {
      fileName: 'test.jpg',
      fileType: 'image/jpeg',
      fileSize: 2048,
      fileData: 'dGVzdCBpbWFnZSBjb250ZW50',
      metadata: [Object]
    },
    timestamp: '2025-08-31T12:39:30.101Z'
  }
}
[2025-08-31T12:39:30.102Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Starting file analysis',
    fileName: 'test.jpg',
    fileType: 'image/jpeg',
    fileSize: 2048
  }
}
[2025-08-31T12:39:30.102Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step started: analyze-file' }
}
[2025-08-31T12:39:30.102Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Analyzing file with AI',
    model: 'gemma-7b-it',
    fileType: 'image'
  }
}
[2025-08-31T12:39:30.102Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step completed: analyze-file' }
}
[2025-08-31T12:39:30.102Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow completed',
    duration: 1,
    result: {
      description: 'AI analyzed image: test.jpg',
      extractedText: 'This is extracted text from the file',
      topics: 'This is extracted text from the file',
      keywords: 'This is extracted text from the file',
      hasText: true,
      metadata: [Object]
    }
  }
}

[90mstdout[2m | tests/unit/workflows/file-analyzer.test.ts[2m > [22m[2mFileAnalyzer[2m > [22m[2mrun[2m > [22m[2mshould handle large files with simple analysis
[22m[39m[2025-08-31T12:39:30.104Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow started',
    params: {
      fileName: 'large.pdf',
      fileType: 'application/pdf',
      fileSize: 3145728,
      fileData: 'bGFyZ2UgZmlsZSBjb250ZW50'
    },
    timestamp: '2025-08-31T12:39:30.104Z'
  }
}
[2025-08-31T12:39:30.104Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Starting file analysis',
    fileName: 'large.pdf',
    fileType: 'application/pdf',
    fileSize: 3145728
  }
}
[2025-08-31T12:39:30.104Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step started: analyze-file' }
}
[2025-08-31T12:39:30.104Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'File too large for AI analysis',
    fileSize: 3145728,
    maxSize: 2097152
  }
}
[2025-08-31T12:39:30.104Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step completed: analyze-file' }
}
[2025-08-31T12:39:30.104Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow completed',
    duration: 0,
    result: {
      description: 'Large pdf file: large.pdf',
      extractedText: 'large.pdf - pdf document (large file)',
      topics: 'pdf',
      keywords: 'large',
      hasText: true,
      metadata: [Object]
    }
  }
}

[90mstdout[2m | tests/unit/workflows/file-analyzer.test.ts[2m > [22m[2mFileAnalyzer[2m > [22m[2mrun[2m > [22m[2mshould reject unsupported file types
[22m[39m[2025-08-31T12:39:30.106Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow started',
    params: {
      fileName: 'test.txt',
      fileType: 'text/plain',
      fileSize: 1024,
      fileData: 'dGV4dCBjb250ZW50'
    },
    timestamp: '2025-08-31T12:39:30.106Z'
  }
}
[2025-08-31T12:39:30.106Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Starting file analysis',
    fileName: 'test.txt',
    fileType: 'text/plain',
    fileSize: 1024
  }
}
[2025-08-31T12:39:30.106Z] ERROR   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow failed',
    error: {
      name: 'AppError',
      message: 'Unsupported file type: text/plain',
      stack: 'AppError: Unsupported file type: text/plain\n' +
        '    at FileAnalyzer.execute (/C:/node/vector-db/src/workflows/file-analyzer.ts:1309:13)\n' +
        '    at FileAnalyzer.run (/C:/node/vector-db/src/base/workflow.ts:1618:60)\n' +
        '    at /C:/node/vector-db/tests/unit/workflows/file-analyzer.test.ts:119:37\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)'
    },
    duration: 0,
    params: {
      fileName: 'test.txt',
      fileType: 'text/plain',
      fileSize: 1024,
      fileData: 'dGV4dCBjb250ZW50'
    }
  }
}

[90mstdout[2m | tests/unit/workflows/file-analyzer.test.ts[2m > [22m[2mFileAnalyzer[2m > [22m[2mrun[2m > [22m[2mshould extract text from various AI response formats
[22m[39m[2025-08-31T12:39:30.108Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow started',
    params: {
      fileName: 'test.pdf',
      fileType: 'application/pdf',
      fileSize: 1024,
      fileData: 'dGVzdCBjb250ZW50'
    },
    timestamp: '2025-08-31T12:39:30.108Z'
  }
}
[2025-08-31T12:39:30.108Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Starting file analysis',
    fileName: 'test.pdf',
    fileType: 'application/pdf',
    fileSize: 1024
  }
}
[2025-08-31T12:39:30.108Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step started: analyze-file' }
}
[2025-08-31T12:39:30.108Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Analyzing file with AI',
    model: 'gemma-7b-it',
    fileType: 'pdf'
  }
}
[2025-08-31T12:39:30.108Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step completed: analyze-file' }
}
[2025-08-31T12:39:30.108Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow completed',
    duration: 0,
    result: {
      description: 'AI analyzed pdf: test.pdf',
      extractedText: 'Direct text response',
      topics: 'Direct text response',
      keywords: 'Direct text response',
      hasText: true,
      metadata: [Object]
    }
  }
}
[2025-08-31T12:39:30.108Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow started',
    params: {
      fileName: 'test.pdf',
      fileType: 'application/pdf',
      fileSize: 1024,
      fileData: 'dGVzdCBjb250ZW50'
    },
    timestamp: '2025-08-31T12:39:30.108Z'
  }
}
[2025-08-31T12:39:30.108Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Starting file analysis',
    fileName: 'test.pdf',
    fileType: 'application/pdf',
    fileSize: 1024
  }
}
[2025-08-31T12:39:30.108Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step started: analyze-file' }
}
[2025-08-31T12:39:30.108Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Analyzing file with AI',
    model: 'gemma-7b-it',
    fileType: 'pdf'
  }
}
[2025-08-31T12:39:30.108Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step completed: analyze-file' }
}
[2025-08-31T12:39:30.108Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow completed',
    duration: 0,
    result: {
      description: 'AI analyzed pdf: test.pdf',
      extractedText: 'OpenAI format response',
      topics: 'OpenAI format response',
      keywords: 'OpenAI format response',
      hasText: true,
      metadata: [Object]
    }
  }
}
[2025-08-31T12:39:30.108Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow started',
    params: {
      fileName: 'test.pdf',
      fileType: 'application/pdf',
      fileSize: 1024,
      fileData: 'dGVzdCBjb250ZW50'
    },
    timestamp: '2025-08-31T12:39:30.108Z'
  }
}
[2025-08-31T12:39:30.109Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Starting file analysis',
    fileName: 'test.pdf',
    fileType: 'application/pdf',
    fileSize: 1024
  }
}
[2025-08-31T12:39:30.109Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step started: analyze-file' }
}
[2025-08-31T12:39:30.109Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Analyzing file with AI',
    model: 'gemma-7b-it',
    fileType: 'pdf'
  }
}
[2025-08-31T12:39:30.109Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step completed: analyze-file' }
}
[2025-08-31T12:39:30.109Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow completed',
    duration: 1,
    result: {
      description: 'AI analyzed pdf: test.pdf',
      extractedText: 'Simple string response',
      topics: 'Simple string response',
      keywords: 'Simple string response',
      hasText: true,
      metadata: [Object]
    }
  }
}

[90mstdout[2m | tests/unit/workflows/file-analyzer.test.ts[2m > [22m[2mFileAnalyzer[2m > [22m[2mrun[2m > [22m[2mshould include metadata in analysis result
[22m[39m[2025-08-31T12:39:30.110Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow started',
    params: {
      fileName: 'document.pdf',
      fileType: 'application/pdf',
      fileSize: 1024,
      fileData: 'dGVzdCBjb250ZW50',
      namespace: 'docs',
      metadata: [Object]
    },
    timestamp: '2025-08-31T12:39:30.110Z'
  }
}
[2025-08-31T12:39:30.111Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Starting file analysis',
    fileName: 'document.pdf',
    fileType: 'application/pdf',
    fileSize: 1024
  }
}
[2025-08-31T12:39:30.111Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step started: analyze-file' }
}
[2025-08-31T12:39:30.111Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Analyzing file with AI',
    model: 'gemma-7b-it',
    fileType: 'pdf'
  }
}
[2025-08-31T12:39:30.111Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step completed: analyze-file' }
}
[2025-08-31T12:39:30.111Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow completed',
    duration: 1,
    result: {
      description: 'AI analyzed pdf: document.pdf',
      extractedText: 'This is extracted text from the file',
      topics: 'This is extracted text from the file',
      keywords: 'This is extracted text from the file',
      hasText: true,
      metadata: [Object]
    }
  }
}

[90mstdout[2m | tests/unit/workflows/file-analyzer.test.ts[2m > [22m[2mFileAnalyzer[2m > [22m[2mrun[2m > [22m[2mshould handle empty AI response
[22m[39m[2025-08-31T12:39:30.112Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow started',
    params: {
      fileName: 'test.pdf',
      fileType: 'application/pdf',
      fileSize: 1024,
      fileData: 'dGVzdCBjb250ZW50'
    },
    timestamp: '2025-08-31T12:39:30.112Z'
  }
}
[2025-08-31T12:39:30.112Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Starting file analysis',
    fileName: 'test.pdf',
    fileType: 'application/pdf',
    fileSize: 1024
  }
}
[2025-08-31T12:39:30.113Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step started: analyze-file' }
}
[2025-08-31T12:39:30.113Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Analyzing file with AI',
    model: 'gemma-7b-it',
    fileType: 'pdf'
  }
}
[2025-08-31T12:39:30.113Z] WARN   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'No text extracted from AI result'
  }
}
[2025-08-31T12:39:30.113Z] DEBUG   - 
  Details: {
  metadata: { context: 'FileAnalyzer', message: 'Step completed: analyze-file' }
}
[2025-08-31T12:39:30.113Z] INFO   - 
  Details: {
  metadata: {
    context: 'FileAnalyzer',
    message: 'Workflow completed',
    duration: 1,
    result: {
      description: 'Large pdf file: test.pdf',
      extractedText: 'test.pdf - pdf document (large file)',
      topics: 'pdf',
      keywords: 'test',
      hasText: true,
      metadata: [Object]
    }
  }
}

 [32m✓[39m tests/unit/workflows/file-analyzer.test.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 5[2mms[22m[39m
 [32m✓[39m tests/unit/routes/embeddings/generateEmbedding.test.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 27[2mms[22m[39m
 [32m✓[39m tests/unit/schemas/cloudflare.schema.test.ts [2m([22m[2m15 tests[22m[2m)[22m[90m 5[2mms[22m[39m
[90mstdout[2m | tests/unit/routes/embeddings/schedule.test.ts[2m > [22m[2mSchedule Batch Embeddings Route[2m > [22m[2mPOST /embeddings/schedule[2m > [22m[2mshould schedule batch embeddings successfully
[22m[39m[2025-08-31T12:39:30.331Z] INFO   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Generating batch embeddings',
    textsCount: 5,
    model: '@cf/baai/bge-base-en-v1.5',
    batchSize: 2
  }
}
[2025-08-31T12:39:30.332Z] INFO   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Batch embedding generation initiated',
    batchId: 'batch-schedule-123',
    workflowCount: 5
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/schedule.test.ts[2m > [22m[2mSchedule Batch Embeddings Route[2m > [22m[2mPOST /embeddings/schedule[2m > [22m[2mshould work with minimal parameters
[22m[39m[2025-08-31T12:39:30.334Z] INFO   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Generating batch embeddings',
    textsCount: 1,
    model: '@cf/baai/bge-base-en-v1.5',
    batchSize: 10
  }
}
[2025-08-31T12:39:30.335Z] INFO   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Batch embedding generation initiated',
    batchId: 'batch-minimal',
    workflowCount: 1
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/schedule.test.ts[2m > [22m[2mSchedule Batch Embeddings Route[2m > [22m[2mPOST /embeddings/schedule[2m > [22m[2mshould handle Durable Object errors
[22m[39m[2025-08-31T12:39:30.340Z] INFO   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Generating batch embeddings',
    textsCount: 2,
    model: '@cf/baai/bge-base-en-v1.5',
    batchSize: 10
  }
}
[2025-08-31T12:39:30.340Z] ERROR   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Failed to generate batch embeddings',
    error: {
      name: 'Error',
      message: 'Scheduling failed',
      stack: 'Error: Scheduling failed\n' +
        '    at /C:/node/vector-db/tests/unit/routes/embeddings/schedule.test.ts:147:66\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
        '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
        '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
        '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
        '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
        '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
    }
  }
}

[90mstderr[2m | tests/unit/routes/embeddings/schedule.test.ts[2m > [22m[2mSchedule Batch Embeddings Route[2m > [22m[2mPOST /embeddings/schedule[2m > [22m[2mshould handle Durable Object errors
[22m[39mError: {
  timestamp: '2025-08-31T12:39:30.340Z',
  path: '/embeddings/schedule',
  method: 'POST',
  query: {},
  error: {
    name: 'AppError',
    message: 'Failed to generate batch embeddings: Scheduling failed',
    stack: 'AppError: Failed to generate batch embeddings: Scheduling failed\n' +
      '    at EmbeddingService.generateBatchEmbeddings (/C:/node/vector-db/src/routes/api/embeddings/embedding-service.ts:1777:13)\n' +
      '    at scheduleBatchEmbeddingHandler (/C:/node/vector-db/src/routes/api/embeddings/schedule.ts:275:45)\n' +
      '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
      '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
      '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
      '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
      '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
      '    at /C:/node/vector-db/tests/unit/routes/embeddings/schedule.test.ts:155:24\n' +
      '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
      '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)',
    code: 'EMBEDDING_GENERATION_ERROR',
    statusCode: 500,
    details: Error: Scheduling failed
        at /C:/node/vector-db/tests/unit/routes/embeddings/schedule.test.ts:147:66
        at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
        at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
        at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
        at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
        at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
        at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
        at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
        at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
        at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)
  }
}

[90mstdout[2m | tests/unit/routes/embeddings/schedule.test.ts[2m > [22m[2mSchedule Batch Embeddings Route[2m > [22m[2mPOST /embeddings/schedule[2m > [22m[2mshould handle non-Error exceptions
[22m[39m[2025-08-31T12:39:30.342Z] INFO   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Generating batch embeddings',
    textsCount: 1,
    model: '@cf/baai/bge-base-en-v1.5',
    batchSize: 10
  }
}
[2025-08-31T12:39:30.342Z] ERROR   - 
  Details: {
  metadata: {
    context: 'EmbeddingService',
    message: 'Failed to generate batch embeddings',
    error: { code: 'SCHEDULE_ERROR' }
  }
}

[90mstderr[2m | tests/unit/routes/embeddings/schedule.test.ts[2m > [22m[2mSchedule Batch Embeddings Route[2m > [22m[2mPOST /embeddings/schedule[2m > [22m[2mshould handle non-Error exceptions
[22m[39mError: {
  timestamp: '2025-08-31T12:39:30.343Z',
  path: '/embeddings/schedule',
  method: 'POST',
  query: {},
  error: {
    name: 'AppError',
    message: 'Failed to generate batch embeddings: Unknown error',
    stack: 'AppError: Failed to generate batch embeddings: Unknown error\n' +
      '    at EmbeddingService.generateBatchEmbeddings (/C:/node/vector-db/src/routes/api/embeddings/embedding-service.ts:1777:13)\n' +
      '    at scheduleBatchEmbeddingHandler (/C:/node/vector-db/src/routes/api/embeddings/schedule.ts:275:45)\n' +
      '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
      '    at C:/node/vector-db/node_modules/hono/dist/validator/validator.js:81:5\n' +
      '    at mw (C:/node/vector-db/node_modules/@hono/zod-openapi/dist/index.js:91:26)\n' +
      '    at dispatch (C:/node/vector-db/node_modules/hono/dist/compose.js:22:17)\n' +
      '    at C:/node/vector-db/node_modules/hono/dist/hono-base.js:201:25\n' +
      '    at /C:/node/vector-db/tests/unit/routes/embeddings/schedule.test.ts:171:24\n' +
      '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:5\n' +
      '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:11)',
    code: 'EMBEDDING_GENERATION_ERROR',
    statusCode: 500,
    details: { code: 'SCHEDULE_ERROR' }
  }
}

 [32m✓[39m tests/unit/routes/embeddings/schedule.test.ts [2m([22m[2m6 tests[22m[2m)[22m[90m 5[2mms[22m[39m
 [32m✓[39m tests/unit/workflows/notion-sync-extract.test.ts [2m([22m[2m18 tests[22m[2m)[22m[90m 6[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/vectors/get.test.ts[2m > [22m[2mGet Vector Route[2m > [22m[2mGET /vectors/{id}[2m > [22m[2mshould handle VectorizeService errors
[22m[39mError: {
  timestamp: '2025-08-31T12:39:30.516Z',
  path: '/vectors/test-id',
  method: 'GET',
  query: {},
  error: {
    name: 'Error',
    message: 'Vectorize service error',
    stack: 'Error: Vectorize service error\n' +
      '    at /C:/node/vector-db/tests/unit/routes/vectors/get.test.ts:75:38\n' +
      '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
      '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
      '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
      '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
      '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
  }
}

[90mstderr[2m | tests/unit/routes/vectors/get.test.ts[2m > [22m[2mGet Vector Route[2m > [22m[2mGET /vectors/{id}[2m > [22m[2mshould handle non-Error exceptions
[22m[39mError: {
  timestamp: '2025-08-31T12:39:30.518Z',
  path: '/vectors/test-id',
  method: 'GET',
  query: {},
  error: 'String error'
}

 [32m✓[39m tests/unit/routes/vectors/get.test.ts [2m([22m[2m10 tests[22m[2m)[22m[90m 11[2mms[22m[39m
 [32m✓[39m tests/unit/schemas/file-upload.schema.test.ts [2m([22m[2m14 tests[22m[2m)[22m[90m 6[2mms[22m[39m
 [32m✓[39m tests/unit/services/notion-data-manager.test.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 24[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/notion/sync-page.test.ts[2m > [22m[2mSync Notion Page Route[2m > [22m[2mPOST /notion/pages/{pageId}/sync[2m > [22m[2mshould handle sync errors
[22m[39mError: {
  timestamp: '2025-08-31T12:39:30.728Z',
  path: '/notion/pages/page-error/sync',
  method: 'POST',
  query: {},
  error: {
    name: 'Error',
    message: 'Sync failed',
    stack: 'Error: Sync failed\n' +
      '    at /C:/node/vector-db/tests/unit/routes/notion/sync-page.test.ts:135:38\n' +
      '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14\n' +
      '    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11\n' +
      '    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)\n' +
      '    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)\n' +
      '    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)\n' +
      '    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)'
  }
}

[90mstderr[2m | tests/unit/routes/notion/sync-page.test.ts[2m > [22m[2mSync Notion Page Route[2m > [22m[2mPOST /notion/pages/{pageId}/sync[2m > [22m[2mshould handle non-Error exceptions
[22m[39mError: {
  timestamp: '2025-08-31T12:39:30.731Z',
  path: '/notion/pages/page-error/sync',
  method: 'POST',
  query: {},
  error: 'String error'
}

 [32m✓[39m tests/unit/routes/notion/sync-page.test.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 19[2mms[22m[39m
 [32m✓[39m tests/unit/workflows/notion-sync-schemas.test.ts [2m([22m[2m17 tests[22m[2m)[22m[90m 5[2mms[22m[39m
 [32m✓[39m tests/unit/routes/search/search-validator.test.ts [2m([22m[2m22 tests[22m[2m)[22m[90m 6[2mms[22m[39m
 [32m✓[39m tests/unit/routes/notion/page-formatter.test.ts [2m([22m[2m13 tests[22m[2m)[22m[90m 5[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/vectors/job-service.test.ts[2m > [22m[2mVectorJobService[2m > [22m[2mgetJobStatus[2m > [22m[2mshould throw error on exception
[22m[39mGet job status error: Error: Connection failed
    at /C:/node/vector-db/tests/unit/routes/vectors/job-service.test.ts:52:56
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

 [32m✓[39m tests/unit/routes/vectors/job-service.test.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 7[2mms[22m[39m
 [32m✓[39m tests/unit/routes/search/search-service.test.ts [2m([22m[2m12 tests[22m[2m)[22m[90m 23[2mms[22m[39m
[90mstderr[2m | tests/unit/services/notion-api-client.test.ts[2m > [22m[2mNotionAPIClient[2m > [22m[2mfetchPage[2m > [22m[2mshould throw error for other API errors
[22m[39mFailed to fetch page from Notion: Error: Notion API error: 500
    at NotionAPIClient.fetchPage (/C:/node/vector-db/src/services/notion-api-client.ts:1130:15)

 [32m✓[39m tests/unit/services/notion-api-client.test.ts [2m([22m[2m8 tests[22m[2m)[22m[90m 10[2mms[22m[39m
[90mstderr[2m | tests/unit/routes/vectors/create.test.ts[2m > [22m[2mCreate Vector Route[2m > [22m[2mPOST /vectors[2m > [22m[2mshould handle Durable Object errors
[22m[39mCreate vector error: Error: Vector creation failed
    at /C:/node/vector-db/tests/unit/routes/vectors/create.test.ts:110:61
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:146:14
    at C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:533:11
    at runWithTimeout (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:39:7)
    at runTest (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1056:17)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runSuite (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1205:15)
    at runFiles (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1262:5)
    at startTests (C:/node/vector-db/node_modules/@vitest/runner/dist/index.js:1271:3)

[90mstderr[2m | tests/unit/routes/vectors/create.test.ts[2m > [22m[2mCreate Vector Route[2m > [22m[2mPOST /vectors[2m > [22m[2mshould handle non-Error exceptions
[22m[39mCreate vector error: Unknown error

 [32m✓[39m tests/unit/routes/vectors/create.test.ts [2m([22m[2m6 tests[22m[2m)[22m[90m 13[2mms[22m[39m
 [32m✓[39m tests/unit/services/vector-search.test.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 14[2mms[22m[39m
 [32m✓[39m tests/unit/routes/files/file-processor.test.ts [2m([22m[2m9 tests[22m[2m)[22m[90m 16[2mms[22m[39m
 [2m[90m↓[39m[22m tests/unit/routes/embeddings.test.ts [2m([22m[2m4 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m
[90mstdout[2m | tests/unit/workflows/chunk-processor.test.ts[2m > [22m[2mChunkProcessor[2m > [22m[2mprocessChunks[2m > [22m[2mshould process text into chunks
[22m[39mStarting chunk processing { textLength: 33, fileName: 'test.txt', namespace: undefined }
Split text into 1 chunks

[90mstdout[2m | tests/unit/workflows/chunk-processor.test.ts[2m > [22m[2mChunkProcessor[2m > [22m[2mprocessChunks[2m > [22m[2mshould handle empty text
[22m[39mStarting chunk processing { textLength: 0, fileName: 'test.txt', namespace: undefined }

[90mstderr[2m | tests/unit/workflows/chunk-processor.test.ts[2m > [22m[2mChunkProcessor[2m > [22m[2mprocessChunks[2m > [22m[2mshould handle empty text
[22m[39mNo text to chunk
No chunks created from text

[90mstdout[2m | tests/unit/workflows/chunk-processor.test.ts[2m > [22m[2mChunkProcessor[2m > [22m[2mprocessChunks[2m > [22m[2mshould apply custom chunk size
[22m[39mStarting chunk processing { textLength: 2000, fileName: 'test.txt', namespace: undefined }
Split text into 5 chunks

[90mstdout[2m | tests/unit/workflows/chunk-processor.test.ts[2m > [22m[2mChunkProcessor[2m > [22m[2mprocessChunks[2m > [22m[2mshould handle chunk overlap
[22m[39mStarting chunk processing { textLength: 100, fileName: 'test.txt', namespace: undefined }
Split text into 1 chunks

[90mstderr[2m | tests/unit/workflows/chunk-processor.test.ts[2m > [22m[2mChunkProcessor[2m > [22m[2mprocessChunks[2m > [22m[2mshould handle chunk overlap
[22m[39mChunk size too small, using minimum: 100

[90mstdout[2m | tests/unit/workflows/chunk-processor.test.ts[2m > [22m[2mChunkProcessor[2m > [22m[2mprocessChunks[2m > [22m[2mshould include metadata in chunks
[22m[39mStarting chunk processing { textLength: 9, fileName: 'test.txt', namespace: 'test-namespace' }
Split text into 1 chunks

 [32m✓[39m tests/unit/workflows/chunk-processor.test.ts [2m([22m[2m5 tests[22m[2m)[22m[90m 4[2mms[22m[39m
 [32m✓[39m tests/unit/routes/files/file-validator.test.ts [2m([22m[2m9 tests[22m[2m)[22m[90m 7[2mms[22m[39m
 [32m✓[39m tests/unit/schemas/embedding.schema.test.ts [2m([22m[2m7 tests[22m[2m)[22m[90m 2[2mms[22m[39m
 [32m✓[39m tests/unit/services/vector-operations.test.ts [2m([22m[2m6 tests[22m[2m)[22m[90m 12[2mms[22m[39m
 [32m✓[39m tests/unit/routes/vectors/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[90m 3[2mms[22m[39m
 [32m✓[39m tests/unit/db.test.ts [2m([22m[2m5 tests[22m[2m)[22m[90m 2[2mms[22m[39m
 [32m✓[39m tests/unit/routes/notion/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[90m 1[2mms[22m[39m
 [32m✓[39m tests/unit/routes/embeddings/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[90m 3[2mms[22m[39m
 [32m✓[39m tests/unit/routes/search/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[90m 3[2mms[22m[39m
 [32m✓[39m tests/unit/routes/files/index.test.ts [2m([22m[2m1 test[22m[2m)[22m[90m 3[2mms[22m[39m
 [32m✓[39m tests/unit/workflows/notion-sync-select-null.test.ts [2m([22m[2m3 tests[22m[2m)[22m[90m 1[2mms[22m[39m
[90mstdout[2m | tests/unit/db.schema.test.ts
[22m[39mRunning DB Schema Tests

 [32m✓[39m tests/unit/db.schema.test.ts [2m([22m[2m2 tests[22m[2m)[22m[90m 1[2mms[22m[39m
 [32m✓[39m tests/simple.test.ts [2m([22m[2m2 tests[22m[2m)[22m
vitest-pool-worker: Unable to remove temporary directory: Error: EBUSY: resource busy or locked, rmdir 'C:\Users\mtama\AppData\Local\Temp\miniflare-7096fc0c40d836c329a0bce88cca76cf\cache\miniflare-CacheObject'
vitest-pool-worker: Unable to remove temporary directory: Error: EBUSY: resource busy or locked, rmdir 'C:\Users\mtama\AppData\Local\Temp\miniflare-7096fc0c40d836c329a0bce88cca76cf\d1\miniflare-D1DatabaseObject'

[2m Test Files [22m [1m[32m83 passed[39m[22m[2m | [22m[33m1 skipped[39m[90m (84)[39m
[2m      Tests [22m [1m[32m1490 passed[39m[22m[2m | [22m[33m15 skipped[39m[90m (1505)[39m
[2m   Start at [22m 21:39:23
[2m   Duration [22m 8.18s[2m (transform 1.73s, setup 636ms, collect 4.08s, tests 1.10s, environment 0ms, prepare 142ms)[22m

[34m % [39m[2mCoverage report from [22m[33mistanbul[39m
-------------------|---------|----------|---------|---------|-------------------
File               | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
-------------------|---------|----------|---------|---------|-------------------
All files          |   97.02 |    90.71 |   98.26 |   97.03 |                   
 base              |     100 |     97.1 |   95.08 |     100 |                   
  ...ble-object.ts |     100 |      100 |   88.23 |     100 |                   
  job-manager.ts   |     100 |    95.55 |   96.29 |     100 | 165,324           
  workflow.ts      |     100 |      100 |     100 |     100 |                   
 db                |     100 |      100 |     100 |     100 |                   
  index.ts         |     100 |      100 |     100 |     100 |                   
 durable-objects   |   99.36 |    93.47 |     100 |   99.34 |                   
  ai-embeddings.ts |     100 |      100 |     100 |     100 |                   
  ...api-client.ts |     100 |      100 |     100 |     100 |                   
  ...on-manager.ts |     100 |      100 |     100 |     100 |                   
  ...nc-manager.ts |     100 |       95 |     100 |     100 | 169,180           
  ...ob-manager.ts |   95.45 |    78.04 |     100 |   95.31 | 89,110,137        
  ...or-manager.ts |     100 |      100 |     100 |     100 |                   
  ...statistics.ts |     100 |    76.66 |     100 |     100 | 63-83,118,282-284 
 ...bjects/schemas |     100 |      100 |     100 |     100 |                   
  ...ger.schema.ts |     100 |      100 |     100 |     100 |                   
  ...ger.schema.ts |     100 |      100 |     100 |     100 |                   
 middleware        |   97.71 |    86.92 |     100 |   97.69 |                   
  auth.ts          |     100 |    88.05 |     100 |     100 | ...93,200-204,225 
  error.ts         |     100 |      100 |     100 |     100 |                   
  logging.ts       |   95.31 |    83.78 |     100 |   95.23 | 143-156           
  validation.ts    |   97.26 |    86.66 |     100 |   97.22 | 68,122            
 ...api/embeddings |   99.37 |    93.18 |     100 |   99.36 |                   
  batch.ts         |   96.15 |    93.75 |     100 |      96 | 74                
  ...ng-service.ts |     100 |     91.3 |     100 |     100 | 192,236-267,294   
  generate.ts      |     100 |      100 |     100 |     100 |                   
  index.ts         |     100 |      100 |     100 |     100 |                   
  models.ts        |     100 |      100 |     100 |     100 |                   
  schedule.ts      |     100 |       50 |     100 |     100 | 85                
 routes/api/files  |     100 |      100 |     100 |     100 |                   
  ...-processor.ts |     100 |      100 |     100 |     100 |                   
  ...-validator.ts |     100 |      100 |     100 |     100 |                   
  index.ts         |     100 |      100 |     100 |     100 |                   
  status.ts        |     100 |      100 |     100 |     100 |                   
  upload.ts        |     100 |      100 |     100 |     100 |                   
 routes/api/notion |     100 |    98.85 |     100 |     100 |                   
  bulk-sync.ts     |     100 |      100 |     100 |     100 |                   
  index.ts         |     100 |      100 |     100 |     100 |                   
  list-pages.ts    |     100 |      100 |     100 |     100 |                   
  ...-formatter.ts |     100 |    97.87 |     100 |     100 | 98                
  ...eve-blocks.ts |     100 |      100 |     100 |     100 |                   
  retrieve-page.ts |     100 |      100 |     100 |     100 |                   
  sync-page.ts     |     100 |      100 |     100 |     100 |                   
 routes/api/search |   97.56 |    93.65 |     100 |   97.56 |                   
  index.ts         |     100 |      100 |     100 |     100 |                   
  ...ch-service.ts |   96.66 |    88.46 |     100 |   96.66 | 168               
  ...-validator.ts |     100 |      100 |     100 |     100 |                   
  semantic.ts      |   94.44 |    91.66 |     100 |   94.44 | 107-113           
  similar.ts       |     100 |      100 |     100 |     100 |                   
  vectors.ts       |     100 |      100 |     100 |     100 |                   
 ...es/api/vectors |   99.37 |    96.55 |     100 |   99.35 |                   
  bulk-delete.ts   |     100 |      100 |     100 |     100 |                   
  create.ts        |     100 |      100 |     100 |     100 |                   
  delete-all.ts    |     100 |      100 |     100 |     100 |                   
  delete.ts        |     100 |      100 |     100 |     100 |                   
  get.ts           |     100 |      100 |     100 |     100 |                   
  index.ts         |     100 |      100 |     100 |     100 |                   
  job-service.ts   |     100 |     90.9 |     100 |     100 | 86                
  list.ts          |     100 |      100 |     100 |     100 |                   
  status.ts        |   96.66 |     87.5 |     100 |   96.66 | 162               
 schemas           |     100 |      100 |     100 |     100 |                   
  ...are.schema.ts |     100 |      100 |     100 |     100 |                   
  ...ult.schema.ts |     100 |      100 |     100 |     100 |                   
  ...ing.schema.ts |     100 |      100 |     100 |     100 |                   
  error.schema.ts  |     100 |      100 |     100 |     100 |                   
  ...oad.schema.ts |     100 |      100 |     100 |     100 |                   
  notion.schema.ts |     100 |      100 |     100 |     100 |                   
  search.schema.ts |     100 |      100 |     100 |     100 |                   
  vector.schema.ts |     100 |      100 |     100 |     100 |                   
 services          |   90.62 |    79.92 |   95.23 |   91.17 |                   
  ...api-client.ts |   81.63 |    80.95 |     100 |   80.85 | ...87,129,144-145 
  ...ta-manager.ts |   72.97 |    46.34 |    82.6 |   75.36 | ...10,241,247-265 
  ...chestrator.ts |   97.36 |       85 |     100 |   97.36 | 90                
  ...on.service.ts |     100 |      100 |     100 |     100 |                   
  ...operations.ts |     100 |      100 |     100 |     100 |                   
  vector-search.ts |     100 |    88.88 |     100 |     100 | 21,32             
  ...ze.service.ts |     100 |      100 |     100 |     100 |                   
 utils             |   91.45 |       88 |   96.87 |   91.17 |                   
  error-handler.ts |     100 |    97.46 |     100 |     100 | 124,286           
  ...der-compat.ts |     100 |      100 |     100 |     100 |                   
  ...se-builder.ts |     100 |    95.83 |     100 |     100 | 94                
  retry.ts         |   87.23 |    63.63 |   95.45 |   86.66 | ...20,146-148,360 
  validation.ts    |   84.44 |    78.48 |   93.93 |   84.09 | ...67,362-363,431 
 workflows         |   97.62 |    93.54 |   99.28 |   97.51 |                   
  ...embeddings.ts |     100 |      100 |     100 |     100 |                   
  ...-processor.ts |    87.5 |    80.55 |   93.33 |   86.66 | ...07-108,198,205 
  embeddings.ts    |     100 |      100 |     100 |     100 |                   
  ...r-recovery.ts |   98.86 |    89.47 |     100 |   98.78 | 196               
  file-analyzer.ts |      98 |       95 |     100 |   97.91 | 72                
  ...processing.ts |     100 |      100 |     100 |     100 |                   
  notion-sync.ts   |     100 |      100 |     100 |     100 |                   
  ...y-handlers.ts |   94.25 |    89.79 |     100 |   94.18 | ...01,219-220,259 
  ...te-machine.ts |     100 |    72.22 |     100 |     100 | ...61-162,207-208 
  ...-generator.ts |   97.56 |    93.47 |     100 |    97.5 | 140-141           
  ...operations.ts |     100 |      100 |     100 |     100 |                   
 workflows/schemas |     100 |      100 |     100 |     100 |                   
  ...low.schema.ts |     100 |      100 |     100 |     100 |                   
-------------------|---------|----------|---------|---------|-------------------
[vpw:debug] Shutting down runtimes...
